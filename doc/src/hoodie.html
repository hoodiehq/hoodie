<!DOCTYPE html><html lang="en"><head><title>src/hoodie</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/hoodie"><meta name="groc-project-path" content="src/hoodie.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/hoodie.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h2 id="hoodie-core">Hoodie Core</h2>

<p>the door to world domination (apps)</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="constructor">Constructor</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>When initializing a hoodie instance, an optional URL
can be passed. That's the URL of the hoodie backend.
If no URL passed it defaults to the current domain.</p>

<pre><code>// init a new hoodie instance
hoodie = new Hoodie
</code></pre></div></div><div class="code"><div class="wrapper"><span class="kd">function</span> <span class="nx">Hoodie</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">hoodie</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>enforce initialization with <code>new</code></p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">hoodie</span> <span class="k">instanceof</span> <span class="nx">Hoodie</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;usage: new Hoodie(url);&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>remove trailing slashes</p></div></div><div class="code"><div class="wrapper">    <span class="nx">hoodie</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">=</span> <span class="nx">baseUrl</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="hoodieextend">hoodie.extend</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>extend hoodie instance:</p>

<pre><code>hoodie.extend(function(hoodie) {} )
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">extension</span><span class="p">(</span><span class="nx">hoodie</span><span class="p">);</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Extending hoodie core</p></div></div><div class="code"><div class="wrapper">  <span class="cm">/* global hoodieAccount, hoodieRemote, hoodieConfig, hoodieStore,</span>
<span class="cm">            hoodiePromises, hoodieRequest, hoodieConnection, hoodieUUID,</span>
<span class="cm">            hoodieDispose, hoodieOpen, hoodieTask</span>
<span class="cm">  */</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.bind</li>
<li>hoodie.on</li>
<li>hoodie.one</li>
<li>hoodie.trigger</li>
<li>hoodie.unbind</li>
<li>hoodie.off</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="cm">/*global hoodieEvents */</span>
  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieEvents</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.defer</li>
<li>hoodie.isPromise</li>
<li>hoodie.resolve</li>
<li>hoodie.reject</li>
<li>hoodie.resolveWith</li>
<li>hoodie.rejectWith</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodiePromises</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.request</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieRequest</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.isOnline</li>
<li>hoodie.checkConnection</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieConnection</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.uuid</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieUUID</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.dispose</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieDispose</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.open</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieOpen</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.store</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieStore</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.task</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieTask</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.config</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieConfig</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.account</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieAccount</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ul>
<li>hoodie.remote</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">hoodieRemote</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Initializations</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set username from config (local store)</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">hoodie</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;_account.username&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>check for pending password reset</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">checkPasswordReset</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>clear config on sign out</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;account:signout&#39;</span><span class="p">,</span> <span class="nx">hoodie</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">clear</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>hoodie.store</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">patchIfNotPersistant</span><span class="p">();</span>
  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">subscribeToOutsideEvents</span><span class="p">();</span>
  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">bootstrapDirtyObjects</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>hoodie.remote</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">subscribeToEvents</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>hoodie.task</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">subscribeToStoreEvents</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>authenticate
we use a closure to not pass the username to connect, as it
would set the name of the remote store, which is not the username.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="cm">/* username */</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">hoodie</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
  <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>check connection when browser goes online / offline</p></div></div><div class="code"><div class="wrapper">  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="nx">hoodie</span><span class="p">.</span><span class="nx">checkConnection</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;offline&#39;</span><span class="p">,</span> <span class="nx">hoodie</span><span class="p">.</span><span class="nx">checkConnection</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>start checking connection</p></div></div><div class="code"><div class="wrapper">  <span class="nx">hoodie</span><span class="p">.</span><span class="nx">checkConnection</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>loading user extensions</p></div></div><div class="code"><div class="wrapper">  <span class="nx">applyExtensions</span><span class="p">(</span><span class="nx">hoodie</span><span class="p">);</span>
<span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="extending-hoodie">Extending hoodie</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>You can either extend the Hoodie class, or a hoodie
instance during runtime</p>

<pre><code>Hoodie.extend('magic1', funcion(hoodie) { /* ... */ })
hoodie = new Hoodie
hoodie.extend('magic2', function(hoodie) { /* ... */ })
hoodie.magic1.doSomething()
hoodie.magic2.doSomethingElse()
</code></pre>

<p>Hoodie can also be extended anonymously</p>

<pre><code> Hoodie.extend(funcion(hoodie) { hoodie.myMagic = function() {} })
</code></pre></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[];</span>

<span class="nx">Hoodie</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">extension</span><span class="p">);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>detect available extensions and attach to Hoodie Object.</p></div></div><div class="code"><div class="wrapper"><span class="kd">function</span> <span class="nx">applyExtensions</span><span class="p">(</span><span class="nx">hoodie</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">extensions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">extensions</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">hoodie</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>expose Hoodie to module loaders. Based on jQuery's implementation.</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Expose Hoodie as module.exports in loaders that implement the Node
module pattern (including browserify). Do not create the global, since
the user will be storing it themselves locally, and globals are frowned
upon in the Node module world.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Hoodie</span><span class="p">;</span>


<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Register as a named AMD module, since Hoodie can be concatenated with other
files that may use define, but not via a proper concatenation script that
understands anonymous AMD modules. A named AMD is safest and most robust
way to register. Lowercase hoodie is used because AMD module names are
derived from file names, and Hoodie is normally delivered in a lowercase
file name.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">define</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Hoodie</span><span class="p">;</span>
  <span class="p">});</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set global</p></div></div><div class="code"><div class="wrapper">  <span class="nx">global</span><span class="p">.</span><span class="nx">Hoodie</span> <span class="o">=</span> <span class="nx">Hoodie</span><span class="p">;</span>
<span class="p">}</span></div></div></div></div></body></html>
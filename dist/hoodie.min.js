// Hoodie.js - 0.9.7
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Hoodie=a()}}(function(){var a,b,c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=b[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return d.isRejected()?d:(b.setHowMany(1),b.setUnwrap(),b.init(),d)}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],2:[function(a,b){(function(c){"use strict";function d(){this._isTickUsed=!1,this._schedule=e,this._length=0,this._lateBuffer=new f(16),this._functionBuffer=new f(65536);var a=this;this.consumeFunctionBuffer=function(){a._consumeFunctionBuffer()}}var e=a("./schedule.js"),f=a("./queue.js"),g=a("./util.js").errorObj,h=a("./util.js").tryCatch1,i="undefined"!=typeof c?c:void 0;d.prototype.haveItemsQueued=function(){return this._length>0},d.prototype.invokeLater=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a)),this._lateBuffer.push(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a));var d=this._functionBuffer;d.push(a,b,c),this._length=d.length(),this._queueTick()},d.prototype._consumeFunctionBuffer=function(){for(var a=this._functionBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}this._reset(),this._consumeLateBuffer()},d.prototype._consumeLateBuffer=function(){for(var a=this._lateBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift(),e=h(b,c,d);if(e===g){if(this._queueTick(),null==b.domain)throw e.e;b.domain.emit("error",e.e)}}},d.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},d.prototype._reset=function(){this._isTickUsed=!1,this._length=0},b.exports=new d}).call(this,a("FWaASH"))},{"./queue.js":25,"./schedule.js":28,"./util.js":35,FWaASH:37}],3:[function(a,b){"use strict";var c=a("./promise.js")();b.exports=c},{"./promise.js":20}],4:[function(a,b){"use strict";var c=Object.create;if(c){var d=c(null),e=c(null);d[" size"]=e[" size"]=0}b.exports=function(b){function c(a){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,a))}function f(a){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",a))}function g(a,b,c){var d=c[a];if("function"!=typeof d){if(!o(a))return null;if(d=b(a),c[a]=d,c[" size"]++,c[" size"]>512){for(var e=Object.keys(c),f=0;256>f;++f)delete c[e[f]];c[" size"]=e.length-256}}return d}function h(a){return g(a,c,d)}function i(a){return g(a,f,e)}function j(a){return a[this.pop()].apply(a,this)}function k(a){return a[this]}function l(a){return a[this]}var m=a("./util.js"),n=m.canEvaluate,o=m.isIdentifier;b.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];if(n){var e=h(a);if(null!==e)return this._then(e,void 0,void 0,c,void 0)}return c.push(a),this._then(j,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=l;else if(n){var d=i(a);b=null!==d?d:k}else b=k;return this._then(b,void 0,void 0,a,void 0)}}},{"./util.js":35}],5:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=d.canAttach,f=a("./async.js"),g=d.CancellationError;b.prototype._cancel=function(a){if(!this.isCancellable())return this;for(var b,c=this;void 0!==(b=c._cancellationParent)&&b.isCancellable();)c=b;c._attachExtraTrace(a),c._rejectUnchecked(a)},b.prototype.cancel=function(a){return this.isCancellable()?(a=void 0!==a?e(a)?a:new Error(a+""):new g,f.invokeLater(this._cancel,this,a),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._propagateFrom(this,6),a._follow(this),a._unsetCancellable(),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":2,"./errors.js":10}],6:[function(a,b){"use strict";b.exports=function(){function b(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var d=/\[object [a-zA-Z0-9$_]+\]/;if(d.test(b))try{var e=JSON.stringify(a);b=e}catch(f){}0===b.length&&(b="(empty array)")}return"(<"+c(b)+">, no stack trace)"}function c(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function d(a,b){this.captureStackTrace(d,b)}var e=a("./util.js").inherits,f=a("./es5.js").defineProperty,g=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),h=null,i=null;e(d,Error),d.prototype.captureStackTrace=function(a,b){j(this,a,b)},d.possiblyUnhandledRejection=function(a){if("object"==typeof console){var b;if("object"==typeof a||"function"==typeof a){var c=a.stack;b="Possibly unhandled "+i(c,a)}else b="Possibly unhandled "+String(a);"function"==typeof console.error||"object"==typeof console.error?console.error(b):("function"==typeof console.log||"object"==typeof console.log)&&console.log(b)}},d.combine=function(a,b){for(var c=a.length-1,d=b.length-1;d>=0;--d){var e=b[d];if(a[c]!==e)break;a.pop(),c--}a.push("From previous event:");for(var f=a.concat(b),i=[],d=0,j=f.length;j>d;++d)g.test(f[d])&&h.test(f[d])||d>0&&!h.test(f[d])&&"From previous event:"!==f[d]||i.push(f[d]);return i},d.protectErrorMessageNewlines=function(a){for(var b=0;b<a.length&&!h.test(a[b]);++b);if(!(1>=b)){for(var c=[],d=0;b>d;++d)c.push(a.shift());a.unshift(c.join("\x00"))}},d.isSupported=function(){return"function"==typeof j};var j=function k(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){h=/^\s*at\s*/,i=function(a,c){return"string"==typeof a?a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)};var a=Error.captureStackTrace;return function(b,c){a(b,c)}}var c=new Error;if("string"==typeof c.stack&&"function"==typeof"".startsWith&&c.stack.startsWith("stackDetection@")&&"stackDetection"===k.name){f(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),h=/@/;var d=/[@\n]/;return i=function(a,c){return"string"==typeof a?c.name+". "+c.message+"\n"+a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)},function(a){for(var b=(new Error).stack,c=b.split(d),e=c.length,f="",g=0;e>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}return i=function(a,c){return"string"==typeof a?a:"object"!=typeof c&&"function"!=typeof c||void 0===c.name||void 0===c.message?b(c):c.name+". "+c.message},null}();return d}},{"./es5.js":12,"./util.js":35}],7:[function(a,b){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a,c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch1,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,i=e._boundTo,j=0,k=this._instances.length;k>j;++j){var l=this._instances[j],m=l===Error||null!=l&&l.prototype instanceof Error;if(m&&a instanceof l){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}if("function"==typeof l&&!m){var o=d(l,a);if(o===h){var p=f.canAttach(h.e)?h.e:new Error(h.e+"");this._promise._attachExtraTrace(p),a=h.e;break}if(o){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}}}return b.e=a,b},c}},{"./errors.js":10,"./es5.js":12,"./util.js":35}],8:[function(a,b){"use strict";var c=a("./util.js"),d=c.isPrimitive,e=c.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},f=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return e&&d(a)?this._then(f(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return e&&d(a)?this._then(f(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":35}],9:[function(a,b){"use strict";b.exports=function(a,b){var c=a.reduce;a.prototype.each=function(a){return c(this,a,null,b)},a.each=function(a,d){return c(a,d,null,b)}}},{}],10:[function(a,b){"use strict";function c(a){try{n(a,"isOperational",!0)}catch(b){}}function d(a){return null==a?!1:a instanceof h||a.isOperational===!0}function e(a){return a instanceof Error}function f(a){return e(a)}function g(a,b){function c(d){return this instanceof c?(this.message="string"==typeof d?d:b,this.name=a,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return m(c,Error),c}function h(a){this.name="OperationalError",this.message=a,this.cause=a,this.isOperational=!0,a instanceof Error?(this.message=a.message,this.stack=a.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var i,j,k=a("./es5.js").freeze,l=a("./util.js"),m=l.inherits,n=l.notEnumerableProp,o=g("CancellationError","cancellation error"),p=g("TimeoutError","timeout error"),q=g("AggregateError","aggregate error");try{i=TypeError,j=RangeError}catch(r){i=g("TypeError","type error"),j=g("RangeError","range error")}for(var s="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),t=0;t<s.length;++t)"function"==typeof Array.prototype[s[t]]&&(q.prototype[s[t]]=Array.prototype[s[t]]);q.prototype.length=0,q.prototype.isOperational=!0;var u=0;q.prototype.toString=function(){var a=Array(4*u+1).join(" "),b="\n"+a+"AggregateError of:\n";u++,a=Array(4*u+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return u--,b},m(h,Error);var v="__BluebirdErrorTypes__",w=Error[v];w||(w=k({CancellationError:o,TimeoutError:p,OperationalError:h,RejectionError:h,AggregateError:q}),n(Error,v,w)),b.exports={Error:Error,TypeError:i,RangeError:j,CancellationError:w.CancellationError,OperationalError:w.OperationalError,TimeoutError:w.TimeoutError,AggregateError:w.AggregateError,originatesFromRejection:d,markAsOriginatingFromRejection:c,canAttach:f}},{"./es5.js":12,"./util.js":35}],11:[function(a,b){"use strict";b.exports=function(b){function c(a){var c=new d(a),e=b.rejected(c),f=e._peekContext();return null!=f&&f._attachExtraTrace(c),e}var d=a("./errors.js").TypeError;return c}},{"./errors.js":10}],12:[function(a,b){var c=function(){"use strict";return void 0===this}();if(c)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:c};else{var d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},h=function(a,b,c){return a[b]=c.value,a},i=function(a){return a},j=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},k=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}};b.exports={isArray:k,keys:g,defineProperty:h,freeze:i,getPrototypeOf:j,isES5:c}}},{}],13:[function(a,b){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],14:[function(a,b){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,void 0);if(h instanceof b)return i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,void 0);if(g instanceof b)return i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":35}],15:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,c){for(var d=l,g=b,h=c.length,i=0;h>i;++i){var j=m(c[i],void 0,a);if(j===d)return g.reject(d.e);var k=e(j,f);if(k instanceof g)return k}return null}function g(a,c,e){var f=this._promise=new b(d);f._setTrace(void 0),this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(n):n}var h=a("./errors.js"),i=h.TypeError,j=a("./util.js").deprecated,k=a("./util.js"),l=k.errorObj,m=k.tryCatch1,n=[];g.prototype.promise=function(){return this._promise},g.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},g.prototype._continue=function(a){if(a===l){this._generator=void 0;var c=h.canAttach(a.e)?a.e:new Error(a.e+"");return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var d=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(d)||this._promise._fulfill(d);else{var g=e(d,void 0);if(!(g instanceof b)&&(g=f(g,this._yieldHandlers),null===g))return void this._throw(new i("A value was yielded that could not be treated as a promise"));g._then(this._next,this._throw,void 0,this,null)}},g.prototype._throw=function(a){h.canAttach(a)&&this._promise._attachExtraTrace(a),this._continue(m(this._generator["throw"],this._generator,a))},g.prototype._next=function(a){this._continue(m(this._generator.next,this._generator,a))},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function");var c=Object(b).yieldHandler,d=g;return function(){var b=a.apply(this,arguments),e=new d(void 0,void 0,c);return e._generator=b,e._next(void 0),e.promise()}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("fn must be a function");n.push(a)},b.spawn=function(a){if(j("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function");var d=new g(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors.js":10,"./util.js":35}],16:[function(a,b){"use strict";b.exports=function(b,c,d,e){var f=a("./util.js"),g=f.canEvaluate,h=f.tryCatch1,i=f.errorObj;if(g){for(var j=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},k=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},l=[],m=[void 0],n=1;5>=n;++n)l.push(j(n)),m.push(k(n));var o=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};o.prototype.callers=m,o.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c],e=h(d,void 0,this);e===i?a._rejectUnchecked(e.e):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,f=arguments.length-1;if(f>0&&"function"==typeof arguments[f]&&(a=arguments[f],6>f&&g)){var h=new b(e);h._setTrace(void 0);for(var i=new o(f,a),j=h._reject,k=l,m=0;f>m;++m){var n=d(arguments[m],void 0);n instanceof b?n.isPending()?n._then(k[m],j,void 0,h,i):n.isFulfilled()?k[m].call(h,n._settledValue,i):(h._reject(n._settledValue),n._unsetRejectionIsUnhandled()):k[m].call(h,n,i)}return h}for(var p=arguments.length,q=new Array(p),r=0;p>r;++r)q[r]=arguments[r];var h=new c(q).promise();return void 0!==a?h.spread(a):h}}},{"./util.js":35}],17:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,b,c,d){this.constructor$(a),this._callback=b,this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=c>=1?[]:m,this._init$(void 0,-2)}function h(a,b,c,d){var e="object"==typeof c&&null!==c?c.concurrency:0;return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new g(a,b,e,d)}var i=a("./util.js"),j=i.tryCatch3,k=i.errorObj,l={},m=[];i.inherits(g,c),g.prototype._init=function(){},g.prototype._promiseFulfilled=function(a,c){var d=this._values;if(null!==d){var f=this.length(),g=this._preservedValues,h=this._limit;if(d[c]===l){if(d[c]=a,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(h>=1&&this._inFlight>=h)return d[c]=a,void this._queue.push(c);null!==g&&(g[c]=a);var i=this._callback,m=this._promise._boundTo,n=j(i,m,a,c,f);if(n===k)return this._reject(n.e);var o=e(n,void 0);if(o instanceof b){if(o.isPending())return h>=1&&this._inFlight++,d[c]=l,o._proxyPromiseArray(this,c);if(!o.isFulfilled())return o._unsetRejectionIsUnhandled(),this._reject(o.reason());n=o.value()}d[c]=n}var p=++this._totalResolved;p>=f&&(null!==g?this._filter(d,g):this._resolve(d))}},g.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){var d=a.pop();this._promiseFulfilled(c[d],d)}},g.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},g.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return"function"!=typeof a?d("fn must be a function"):h(this,a,b,null).promise()},b.map=function(a,b,c,e){return"function"!=typeof b?d("fn must be a function"):h(a,b,c,e).promise()}}},{"./util.js":35}],18:[function(a,b){"use strict";b.exports=function(b){function c(a){throw a}function d(a,b){if(!g.isArray(a))return e(a,b);var d=g.tryCatchApply(this,[null].concat(a),b);d===k&&h.invokeLater(c,void 0,d.e)}function e(a,b){var d=this,e=void 0===a?j(d,b,null):i(d,b,null,a);e===k&&h.invokeLater(c,void 0,e.e)}function f(a,b){var d=this,e=j(d,b,a);e===k&&h.invokeLater(c,void 0,e.e)}var g=a("./util.js"),h=a("./async.js"),i=g.tryCatch2,j=g.tryCatch1,k=g.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var c=e;void 0!==b&&Object(b).spread&&(c=d),this._then(c,f,void 0,a,this._boundTo)}return this}}},{"./async.js":2,"./util.js":35}],19:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=a("./errors.js"),g=d.tryCatch1,h=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(a)},b.prototype._clearFirstHandlerData$Base=b.prototype._clearFirstHandlerData,b.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[(a<<2)+a-5+2]},b.prototype._doProgressWith=function(a){var c=a.value,d=a.handler,e=a.promise,i=a.receiver,j=g(d,i,c);if(j===h){if(null!=j.e&&"StopProgressPropagation"!==j.e.name){var k=f.canAttach(j.e)?j.e:new Error(j.e+"");e._attachExtraTrace(k),e._progress(j.e)}}else j instanceof b?j._then(e._progress,null,null,e,void 0):e._progress(j)},b.prototype._progressUnchecked=function(a){if(this.isPending())for(var d=this._length(),f=this._progress,g=0;d>g;g++){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof b&&j._isProxied()?j._progressUnchecked(a):j instanceof c&&j._promiseProgressed(a,i)}}}}},{"./async.js":2,"./errors.js":10,"./util.js":35}],20:[function(a,b){(function(c){"use strict";function d(a){try{Promise===a&&(Promise=e)}catch(b){}return a}var e;"undefined"!=typeof Promise&&(e=Promise),b.exports=function(){function b(a){if("function"!=typeof a)throw new w("the promise constructor requires a resolver function");if(this.constructor!==b)throw new w("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==i&&this._resolveFromResolver(a)}function e(a){return a[0]}var f=a("./util.js"),g=a("./async.js"),h=a("./errors.js"),i=function(){},j={},k={e:null},l=a("./thenables.js")(b,i),m=a("./promise_array.js")(b,i,l),n=a("./captured_trace.js")(),o=a("./catch_filter.js")(k),p=a("./promise_resolver.js"),q=f.isArray,r=f.errorObj,s=f.tryCatch1,t=f.tryCatch2,u=f.tryCatchApply,v=h.RangeError,w=h.TypeError,x=h.CancellationError,y=h.TimeoutError,z=h.OperationalError,A=h.originatesFromRejection,B=h.markAsOriginatingFromRejection,C=h.canAttach,D=f.thrower,E=a("./errors_api_rejection")(b),F=function(){return new w("circular promise resolution chain")};b.prototype.bind=function(a){var c=l(a,void 0),d=new b(i);if(c instanceof b){var f=c.then(function(a){d._setBoundTo(a)}),g=b.all([this,f]).then(e);d._follow(g)}else d._follow(this),d._setBoundTo(a);return d._propagateFrom(this,3),d},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype["catch"]=function(a){var b=arguments.length;if(b>1){var c,d=new Array(b-1),e=0;for(c=0;b-1>c;++c){var f=arguments[c];if("function"!=typeof f){var h=new w("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(h),void g.invoke(this._reject,this,h)}d[e++]=f}d.length=e,a=arguments[c],this._resetTrace();var i=new o(d,a,this);return this._then(void 0,i.doFilter,void 0,i,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){return this._then(a,b,void 0,j,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this._settledValue,a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this._settledValue,a.isRejected=!0),a},b.prototype.all=function(){return new m(this).promise()},b.is=function(a){return a instanceof b},b.all=function(a){return new m(a).promise()},b.prototype.error=function(a){return this.caught(A,a)},b.prototype._resolveFromSyncValue=function(a){if(a===r)this._cleanValues(),this._setRejected(),this._settledValue=a.e,this._ensurePossibleRejectionHandled();else{var c=l(a,void 0);c instanceof b?this._follow(c):(this._cleanValues(),this._setFulfilled(),this._settledValue=a)}},b.method=function(a){if("function"!=typeof a)throw new w("fn must be a function");return function(){var c;switch(arguments.length){case 0:c=s(a,this,void 0);break;case 1:c=s(a,this,arguments[0]);break;case 2:c=t(a,this,arguments[0],arguments[1]);break;default:for(var d=arguments.length,e=new Array(d),f=0;d>f;++f)e[f]=arguments[f];c=u(a,e,this)}var g=new b(i);return g._setTrace(void 0),g._resolveFromSyncValue(c),g}},b.attempt=b["try"]=function(a,c,d){if("function"!=typeof a)return E("fn must be a function");var e=q(c)?u(a,c,d):s(a,d,c),f=new b(i);return f._setTrace(void 0),f._resolveFromSyncValue(e),f},b.defer=b.pending=function(){var a=new b(i);return a._setTrace(void 0),new p(a)},b.bind=function(a){var c=l(a,void 0),d=new b(i);if(d._setTrace(void 0),c instanceof b){var e=c.then(function(a){d._setBoundTo(a)});d._follow(e)}else d._setBoundTo(a),d._setFulfilled();return d},b.cast=function(a){var c=l(a,void 0);if(!(c instanceof b)){var d=c;c=new b(i),c._setTrace(void 0),c._setFulfilled(),c._cleanValues(),c._settledValue=d}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(i);if(c._setTrace(void 0),B(a),c._cleanValues(),c._setRejected(),c._settledValue=a,!C(a)){var d=new Error(a+"");c._setCarriedStackTrace(d)}return c._ensurePossibleRejectionHandled(),c},b.onPossiblyUnhandledRejection=function(a){n.possiblyUnhandledRejection="function"==typeof a?a:void 0};var G;b.onUnhandledRejectionHandled=function(a){G="function"==typeof a?a:void 0};var H=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);b.longStackTraces=function(){if(g.haveItemsQueued()&&H===!1)throw new Error("cannot enable long stack traces after promises have been created");H=n.isSupported()},b.hasLongStackTraces=function(){return H&&n.isSupported()},b.prototype._then=function(a,c,d,e,f){var h=void 0!==f,j=h?f:new b(i);if(!h){if(H){var k=this._peekContext()===this._traceParent;j._traceParent=k?this._traceParent:this}j._propagateFrom(this,7)}var l=this._addCallbacks(a,c,d,j,e);return this.isResolved()&&g.invoke(this._queueSettleAt,this,l),j},b.prototype._length=function(){return 262143&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-262144&this._bitField|262143&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},b.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[(a<<2)+a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[(a<<2)+a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[(a<<2)+a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[(a<<2)+a-5+1]},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=262138&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=(f<<2)+f-5;this[g+3]=d,this[g+4]=e,this[g+0]="function"==typeof a?a:void 0,this[g+1]="function"==typeof b?b:void 0,this[g+2]="function"==typeof c?c:void 0}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=262138&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=(c<<2)+c-5;this[d+3]=b,this[d+4]=a,this[d+0]=this[d+1]=this[d+2]=void 0}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._proxyPromise=function(a){a._setProxied(),this._setProxyHandlers(a,-15)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveFromResolver=function(a){function b(a){d._tryFollow(a)||d._fulfill(a)}function c(a){var b=C(a)?a:new Error(a+"");d._attachExtraTrace(b),B(a),d._reject(a,b===a?void 0:b)}var d=this;this._setTrace(void 0),this._pushContext();var e=t(a,void 0,b,c);if(this._popContext(),void 0!==e&&e===r){var f=e.e,g=C(f)?f:new Error(f+"");d._reject(f,g)}},b.prototype._spreadSlowCase=function(a,b,c,d){var e=new m(c).promise(),f=e._then(function(){return a.apply(d,arguments)},void 0,void 0,j,void 0);b._follow(f)},b.prototype._callSpread=function(a,c,d){var e=this._boundTo;if(q(d))for(var f=0,g=d.length;g>f;++f)if(l(d[f],void 0)instanceof b)return void this._spreadSlowCase(a,c,d,e);return c._pushContext(),u(a,d,e)},b.prototype._callHandler=function(a,b,c,d){var e;return b!==j||this.isRejected()?(c._pushContext(),e=s(a,b,d)):e=this._callSpread(a,c,d),c._popContext(),e},b.prototype._settlePromiseFromHandler=function(a,c,d,e){if(!(e instanceof b))return void a.call(c,d,e);var f=this._callHandler(a,c,e,d);if(!e._isFollowing())if(f===r||f===e||f===k){var g=f===e?F():f.e,h=C(g)?g:new Error(g+"");f!==k&&e._attachExtraTrace(h),e._rejectUnchecked(g,h)}else{var i=l(f,e);if(i instanceof b){if(i.isRejected()&&!i._isCarryingStackTrace()&&!C(i._settledValue)){var h=new Error(i._settledValue+"");
e._attachExtraTrace(h),i._setCarriedStackTrace(h)}e._follow(i),e._propagateFrom(i,1)}else e._fulfillUnchecked(f)}},b.prototype._follow=function(a){this._setFollowing(),a.isPending()?(this._propagateFrom(a,1),a._proxyPromise(this)):a.isFulfilled()?this._fulfillUnchecked(a._settledValue):this._rejectUnchecked(a._settledValue,a._getCarriedStackTrace()),a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled(),H&&null==a._traceParent&&(a._traceParent=this)},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=l(a,void 0);return c instanceof b?(this._follow(c),!0):!1},b.prototype._resetTrace=function(){H&&(this._trace=new n(void 0===this._peekContext()))},b.prototype._setTrace=function(a){if(H){var b=this._peekContext();this._traceParent=b;var c=void 0===b;this._trace=void 0!==a&&a._traceParent===b?a._trace:new n(c)}return this},b.prototype._attachExtraTrace=function(a){if(H){var b=this,c=a.stack;c="string"==typeof c?c.split("\n"):[],n.protectErrorMessageNewlines(c);for(var d=1,e=1;null!=b&&null!=b._trace;)c=n.combine(c,b._trace.stack.split("\n")),b=b._traceParent,e++;var f=Error.stackTraceLimit||10,g=(f+d)*e,h=c.length;h>g&&(c.length=g),h>0&&(c[0]=c[0].split("\x00").join("\n")),a.stack=c.length<=d?"(No stack trace)":c.join("\n")}},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo),(2&b)>0&&this._setTrace(a)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this.isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),d=this._settledValue,e=this._receiverAt(a),f=this._promiseAt(a);if("function"==typeof c)this._settlePromiseFromHandler(c,e,d,f);else{var g=!1,h=this.isFulfilled();void 0!==e&&(e instanceof b&&e._isProxied()?(e._unsetProxied(),h?e._fulfillUnchecked(d):e._rejectUnchecked(d,this._getCarriedStackTrace()),g=!0):e instanceof m&&(h?e._promiseFulfilled(d,f):e._promiseRejected(d,f),g=!0)),g||(h?f._fulfill(d):f._reject(d,this._getCarriedStackTrace()))}a>=4&&this._queueGC()},b.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},b.prototype._setProxied=function(){this._bitField=4194304|this._bitField},b.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},b.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),g.invokeLater(this._gc,this,void 0))},b.prototype._gc=function(){for(var a=5*this._length()-5,b=0;a>b;b++)delete this[b];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},b.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},b.prototype._queueSettleAt=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),g.invoke(this._settlePromiseAt,this,a)},b.prototype._fulfillUnchecked=function(a){if(this.isPending()){if(a===this){var b=F();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=a;var c=this._length();c>0&&g.invoke(this._settlePromises,this,c)}},b.prototype._rejectUncheckedCheckError=function(a){var b=C(a)?a:new Error(a+"");this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(this.isPending()){if(a===this){var c=F();return this._attachExtraTrace(c),this._rejectUnchecked(c)}if(this._cleanValues(),this._setRejected(),this._settledValue=a,this._isFinal())return void g.invokeLater(D,void 0,void 0===b?a:b);var d=this._length();void 0!==b&&this._setCarriedStackTrace(b),d>0?g.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},b.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},b.prototype._settlePromises=function(){for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==n.possiblyUnhandledRejection&&g.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof G&&g.invokeLater(G,void 0,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue,b=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==b&&(this._unsetCarriedStackTrace(),a=b),"function"==typeof n.possiblyUnhandledRejection&&n.possiblyUnhandledRejection(a,this)}};var I=[];return b.prototype._peekContext=function(){var a=I.length-1;return a>=0?I[a]:void 0},b.prototype._pushContext=function(){H&&I.push(this)},b.prototype._popContext=function(){H&&I.pop()},b.noConflict=function(){return d(b)},b.setScheduler=function(a){if("function"!=typeof a)throw new w("fn must be a function");g._schedule=a},n.isSupported()||(b.longStackTraces=function(){},H=!1),b._makeSelfResolutionError=F,a("./finally.js")(b,k,l),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,m,l,i),b.RangeError=v,b.CancellationError=x,b.TimeoutError=y,b.TypeError=w,b.OperationalError=z,b.RejectionError=z,b.AggregateError=h.AggregateError,f.toFastProperties(b),f.toFastProperties(b.prototype),b.Promise=b,a("./timers.js")(b,i,l),a("./race.js")(b,i,l),a("./call_get.js")(b),a("./generators.js")(b,E,i,l),a("./map.js")(b,m,E,l,i),a("./nodeify.js")(b),a("./promisify.js")(b,i),a("./props.js")(b,m,l),a("./reduce.js")(b,m,E,l,i),a("./settle.js")(b,m),a("./some.js")(b,m,E),a("./progress.js")(b,m),a("./cancel.js")(b,i),a("./filter.js")(b,i),a("./any.js")(b,m),a("./each.js")(b,i),a("./using.js")(b,E,l),b.prototype=b.prototype,b}}).call(this,a("FWaASH"))},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./errors_api_rejection":11,"./filter.js":13,"./finally.js":14,"./generators.js":15,"./join.js":16,"./map.js":17,"./nodeify.js":18,"./progress.js":19,"./promise_array.js":21,"./promise_resolver.js":22,"./promisify.js":23,"./props.js":24,"./race.js":26,"./reduce.js":27,"./settle.js":29,"./some.js":30,"./synchronous_inspection.js":31,"./thenables.js":32,"./timers.js":33,"./using.js":34,"./util.js":35,FWaASH:37}],21:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function f(a){var d=this._promise=new b(c),e=void 0;a instanceof b&&(e=a,d._propagateFrom(e,5)),d._setTrace(e),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var g=a("./errors.js").canAttach,h=a("./util.js"),i=h.isArray;return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function j(a,c){var f=d(this._values,void 0);if(f instanceof b){if(this._values=f,f._setBoundTo(this._promise._boundTo),!f.isFulfilled())return f.isPending()?void f._then(j,this._reject,void 0,this,c):(f._unsetRejectionIsUnhandled(),void this._reject(f._settledValue));if(f=f._settledValue,!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(g)}}else if(!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(g)}if(0===f.length)return void(-5===c?this._resolveEmptyArray():this._resolve(e(c)));for(var h=this.getActualLength(f.length),k=h,l=this.shouldCopyValues()?new Array(h):this._values,m=!1,n=0;h>n;++n){var o=d(f[n],void 0);o instanceof b?o.isPending()?o._proxyPromiseArray(this,n):(o._unsetRejectionIsUnhandled(),m=!0):m=!0,l[n]=o}this._values=l,this._length=k,m&&this._scanDirectValues(h)},f.prototype._settlePromiseAt=function(a){var c=this._values[a];c instanceof b?c.isFulfilled()?this._promiseFulfilled(c._settledValue,a):c.isRejected()&&this._promiseRejected(c._settledValue,a):this._promiseFulfilled(c,a)},f.prototype._scanDirectValues=function(a){for(var b=0;a>b&&!this._isResolved();++b)this._settlePromiseAt(b)},f.prototype._isResolved=function(){return null===this._values},f.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},f.prototype.__hardReject__=f.prototype._reject=function(a){this._values=null;var b=g(a)?a:new Error(a+"");this._promise._attachExtraTrace(b),this._promise._reject(a,b)},f.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({index:b,value:a})},f.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)}},f.prototype._promiseRejected=function(a){this._isResolved()||(this._totalResolved++,this._reject(a))},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(a){return a},f}},{"./errors.js":10,"./util.js":35}],22:[function(a,b){"use strict";function c(a){return a instanceof Error&&n.getPrototypeOf(a)===Error.prototype}function d(a){var b;return b=c(a)?new k(a):a,i.markAsOriginatingFromRejection(b),b}function e(a){function b(b,c){if(null!==a){if(b){var e=d(h(b));a._attachExtraTrace(e),a._reject(e)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),i=1;f>i;++i)g[i-1]=arguments[i];a._fulfill(g)}else a._fulfill(c);a=null}}return b}var f,g=a("./util.js"),h=g.maybeWrapAsError,i=a("./errors.js"),j=i.TimeoutError,k=i.OperationalError,l=a("./async.js"),m=g.haveGetters,n=a("./es5.js");if(f=m?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=e(a),this.callback=this.asCallback},m){var o={get:function(){return e(this.promise)}};n.defineProperty(f.prototype,"asCallback",o),n.defineProperty(f.prototype,"callback",o)}f._nodebackForPromise=e,f.prototype.toString=function(){return"[object PromiseResolver]"},f.prototype.resolve=f.prototype.fulfill=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;b._tryFollow(a)||l.invoke(b._fulfill,b,a)},f.prototype.reject=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;i.markAsOriginatingFromRejection(a);var c=i.canAttach(a)?a:new Error(a+"");b._attachExtraTrace(c),l.invoke(b._reject,b,a),c!==a&&l.invoke(this._setCarriedStackTrace,this,c)},f.prototype.progress=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");l.invoke(this.promise._progress,this.promise,a)},f.prototype.cancel=function(){l.invoke(this.promise.cancel,this.promise,void 0)},f.prototype.timeout=function(){this.reject(new j("timeout"))},f.prototype.isResolved=function(){return this.promise.isResolved()},f.prototype.toJSON=function(){return this.promise.toJSON()},f.prototype._setCarriedStackTrace=function(a){this.promise.isRejected()&&this.promise._setCarriedStackTrace(a)},b.exports=f},{"./async.js":2,"./errors.js":10,"./es5.js":12,"./util.js":35}],23:[function(a,b){"use strict";b.exports=function(b,c){function d(a){return a.replace(/([$])/,"\\$")}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,A);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '"+b+"'-suffix")}}function h(a,b,c,d){for(var h=s.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k];"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a)||i.push(k,l)}return g(i,b,c),i}function i(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function j(a){return s.filledRange(a,"arguments[","]")}function k(a){return s.filledRange(a,"_arg","")}function l(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function m(a){return s.isIdentifier(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function n(a,d,e,f,g){function h(b){var c,e=j(b).join(", "),f=b>0?", ":"";return c="string"==typeof a?"                                                          \n                this.method(args, fn);                                       \n                break;                                                       \n            ".replace(".method",m(a)):d===r?"                                                         \n                callback.call(this, args, fn);                               \n                break;                                                       \n            ":void 0!==d?"                                                         \n                callback.call(receiver, args, fn);                           \n                break;                                                       \n            ":"                                                         \n                callback(args, fn);                                          \n                break;                                                       \n            ",c.replace("args",e).replace(", ",f)}function n(){for(var b="",c=0;c<p.length;++c)b+="case "+p[c]+":"+h(p[c]);var e;return e="string"==typeof a?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",m(a)):d===r?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",b+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",e)}var o=Math.max(0,l(f)-1),p=i(o),q="string"==typeof e&&s.isIdentifier(e)?e+g:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",q).replace("Parameters",k(o)).replace("[CodeForSwitchCase]",n()))(b,a,d,u,v,t,c)}function o(a,d){function e(){var e=d;d===r&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._setTrace(void 0);var g=t(f);try{a.apply(e,u(arguments,g))}catch(h){var i=v(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function p(a,b,c,e){for(var f=new RegExp(d(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],m=k+b;a[m]=e===B?B(k,r,k,l,b):e(l)}return s.toFastProperties(a),a}function q(a,b){return B(a,b,void 0,a)}var r={},s=a("./util.js"),t=a("./promise_resolver.js")._nodebackForPromise,u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z=function(a,b){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&!s.isClass(b)},A={__isPromisified__:!0},B=w?n:o;b.promisify=function(a,b){if("function"!=typeof a)throw new x("fn must be a function");return e(a)?a:q(a,arguments.length<2?r:b)},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function");b=Object(b);var c=b.suffix;"string"!=typeof c&&(c=y);var d=b.filter;"function"!=typeof d&&(d=z);var e=b.promisifier;if("function"!=typeof e&&(e=B),!s.isIdentifier(c))throw new RangeError("suffix must be a valid identifier");for(var f=s.inheritedDataKeys(a,{includeHidden:!0}),g=0;g<f.length;++g){var h=a[f[g]];"constructor"!==f[g]&&s.isClass(h)&&(p(h.prototype,c,d,e),p(h,c,d,e))}return p(a,c,d,e)}}},{"./errors":10,"./promise_resolver.js":22,"./util.js":35}],24:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){for(var b=j.keys(a),c=b.length,d=new Array(2*c),e=0;c>e;++e){var f=b[e];d[e]=a[f],d[e+c]=f}this.constructor$(d)}function f(a){var c,f=d(a,void 0);return i(f)?(c=f instanceof b?f._then(b.props,void 0,void 0,void 0,void 0):new e(f).promise(),f instanceof b&&c._propagateFrom(f,4),c):h("cannot await properties of a non-object")}var g=a("./util.js"),h=a("./errors_api_rejection")(b),i=g.isObject,j=a("./es5.js");g.inherits(e,c),e.prototype._init=function(){this._init$(void 0,-3)},e.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}}},e.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({key:this._values[b+this.length()],value:a})},e.prototype.shouldCopyValues=function(){return!1},e.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return f(this)},b.props=function(a){return f(a)}}},{"./errors_api_rejection":11,"./es5.js":12,"./util.js":35}],25:[function(a,b){"use strict";function c(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function d(a){this._capacity=a,this._length=0,this._front=0,this._makeCapacity()}d.prototype._willBeOverCapacity=function(a){return this._capacity<a},d.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},d.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},d.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},d.prototype.length=function(){return this._length},d.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},d.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},d.prototype._resizeTo=function(a){var b=this._front,d=this._capacity,e=new Array(d),f=this.length();if(c(this,0,e,0,d),this._capacity=a,this._makeCapacity(),this._front=0,d>=b+f)c(e,b,this,0,f);else{var g=f-(b+f&d-1);c(e,b,this,0,g),c(e,0,this,g,f-g)}},b.exports=d},{}],26:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a,e){var j=d(a,void 0);if(j instanceof b)return h(j);if(!g(a))return f("expecting an array, a promise or a thenable");var k=new b(c);void 0!==e?k._propagateFrom(e,7):k._setTrace(void 0);for(var l=k._fulfill,m=k._reject,n=0,o=a.length;o>n;++n){var p=a[n];(void 0!==p||i.call(a,n))&&b.cast(p)._then(l,m,void 0,k,null)}return k}var f=a("./errors_api_rejection.js")(b),g=a("./util.js").isArray,h=function(a){return a.then(function(b){return e(b,a)})},i={}.hasOwnProperty;b.race=function(a){return e(a,void 0)},b.prototype.race=function(){return e(this,void 0)}}},{"./errors_api_rejection.js":11,"./util.js":35}],27:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,c,d,g){this.constructor$(a),this._preservedValues=g===f?[]:null,this._zerothIsAccum=void 0===d,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var h=e(d,void 0),i=!1,j=h instanceof b;j&&(h.isPending()?h._proxyPromiseArray(this,-1):h.isFulfilled()?(d=h.value(),this._gotAccum=!0):(h._unsetRejectionIsUnhandled(),this._reject(h.reason()),i=!0)),j||this._zerothIsAccum||(this._gotAccum=!0),this._callback=c,this._accum=d,i||this._init$(void 0,-5)}function h(a,b,c,e){if("function"!=typeof b)return d("fn must be a function");var f=new g(a,b,c,e);return f.promise()}var i=a("./util.js"),j=i.tryCatch4,k=i.tryCatch3,l=i.errorObj;i.inherits(g,c),g.prototype._init=function(){},g.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},g.prototype._promiseFulfilled=function(a,c){var d=this._values;if(null!==d){var f,g=this.length(),h=this._preservedValues,i=null!==h,m=this._gotAccum,n=this._valuesPhase;if(!n)for(n=this._valuesPhase=Array(g),f=0;g>f;++f)n[f]=0;if(f=n[c],0===c&&this._zerothIsAccum?(m||(this._accum=a,this._gotAccum=m=!0),n[c]=0===f?1:2):-1===c?m||(this._accum=a,this._gotAccum=m=!0):0===f?n[c]=1:(n[c]=2,m&&(this._accum=a)),m){for(var o,p=this._callback,q=this._promise._boundTo,r=this._reducingIndex;g>r;++r)if(f=n[r],2!==f){if(1!==f)return;if(a=d[r],a instanceof b){if(!a.isFulfilled())return a.isPending()?void 0:(a._unsetRejectionIsUnhandled(),this._reject(a.reason()));a=a._settledValue}if(i?(h.push(a),o=k(p,q,a,r,g)):o=j(p,q,this._accum,a,r,g),o===l)return this._reject(o.e);var s=e(o,void 0);if(s instanceof b){if(s.isPending())return n[r]=4,s._proxyPromiseArray(this,r);if(!s.isFulfilled())return s._unsetRejectionIsUnhandled(),this._reject(s.reason());o=s.value()}this._reducingIndex=r+1,this._accum=o}else this._reducingIndex=r+1;this._reducingIndex<g||this._resolve(i?h:this._accum)}}},b.prototype.reduce=function(a,b){return h(this,a,b,null)},b.reduce=function(a,b,c,d){return h(a,b,c,d)}}},{"./util.js":35}],28:[function(a,b){(function(a){"use strict";var c,d;if("object"==typeof a&&"string"==typeof a.version)c=function(b){a.nextTick(b)};else if("undefined"!=typeof MutationObserver&&(d=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(d=WebKitMutationObserver))c=function(){var a=document.createElement("div"),b=void 0,c=new d(function(){var a=b;b=void 0,a()});return c.observe(a,{attributes:!0}),function(c){b=c,a.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");c=function(a){setTimeout(a,0)}}b.exports=c}).call(this,a("FWaASH"))},{FWaASH:37}],29:[function(a,b){"use strict";b.exports=function(b,c){function d(a){this.constructor$(a)}var e=b.PromiseInspection,f=a("./util.js");f.inherits(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)}},d.prototype._promiseRejected=function(a,b){if(!this._isResolved()){var c=new e;c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)}},b.settle=function(a){return new d(a).promise()},b.prototype.settle=function(){return new d(this).promise()}}},{"./util.js":35}],30:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer");var c=new e(a),f=c.promise();return f.isRejected()?f:(c.setHowMany(b),c.init(),f)}var g=a("./util.js"),h=a("./errors.js").RangeError,i=a("./errors.js").AggregateError,j=g.isArray;g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},e.prototype._promiseFulfilled=function(a){this._isResolved()||(this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},e.prototype._promiseRejected=function(a){if(!this._isResolved()&&(this._addRejected(a),this.howMany()>this._canPossiblyFulfill())){for(var b=new i,c=this.length();c<this._values.length;++c)b.push(this._values[c]);this._reject(b)}},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors.js":10,"./util.js":35}],31:[function(a,b){"use strict";b.exports=function(a){function b(a){void 0!==a?(this._bitField=a._bitField,this._settledValue=a.isResolved()?a._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}b.prototype.isFulfilled=a.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype.isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype.isPending=function(){return 0===(402653184&this._bitField)},b.prototype.value=a.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},b.prototype.error=b.prototype.reason=a.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},b.prototype.isResolved=a.prototype.isResolved=function(){return(402653184&this._bitField)>0},a.PromiseInspection=b}},{}],32:[function(a,b){"use strict";b.exports=function(b,c){function d(a){try{return a.then}catch(b){return j.e=b,j}}function e(a,e){if(k(a)){if(a instanceof b)return a;if(f(a)){var h=new b(c);return h._setTrace(void 0),a._then(h._fulfillUnchecked,h._rejectUncheckedCheckError,h._progressUnchecked,h,null),h._setFollowing(),h}var l=d(a);if(l===j)return void 0!==e&&i(l.e)&&e._attachExtraTrace(l.e),b.reject(l.e);if("function"==typeof l)return g(a,l,e)}return a}function f(a){return l.call(a,"_promise0")}function g(a,c,d){function e(c){if(!j){if(j=!0,a===c){var e=b._makeSelfResolutionError();return void 0!==d&&d._attachExtraTrace(e),void h.promise._reject(e,void 0)}h.resolve(c)}}function f(a){if(!j){j=!0;var b=i(a)?a:new Error(a+"");void 0!==d&&d._attachExtraTrace(b),h.promise._reject(a,b)}}function g(a){if(!j){var b=h.promise;"function"==typeof b._progress&&b._progress(a)}}var h=b.defer(),j=!1;try{c.call(a,e,f,g)}catch(k){if(!j){j=!0;var l=i(k)?k:new Error(k+"");void 0!==d&&d._attachExtraTrace(l),h.promise._reject(k,l)}}return h.promise}var h=a("./util.js"),i=a("./errors.js").canAttach,j=h.errorObj,k=h.isObject,l={}.hasOwnProperty;return e}},{"./errors.js":10,"./util.js":35}],33:[function(a,b){"use strict";var c=function(a,b){var c=arguments.length,d=arguments[2],e=arguments[3],f=c>=5?arguments[4]:void 0;setTimeout(function(){a(d,e,f)},0|b)};b.exports=function(b,d,e){var f=(a("./util.js"),a("./errors.js")),g=(a("./errors_api_rejection")(b),b.TimeoutError),h=function(a,b,c){if(a.isPending()){"string"!=typeof b&&(b="operation timed out after "+c+" ms");var d=new g(b);f.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._cancel(d)}},i=function(a,b){b._fulfill(a)},j=b.delay=function(a,f){void 0===f&&(f=a,a=void 0),f=+f;var g=e(a,void 0),h=new b(d);return g instanceof b?(h._propagateFrom(g,7),h._follow(g),h.then(function(a){return b.delay(a,f)})):(h._setTrace(void 0),c(i,f,a,h),h)};b.prototype.delay=function(a){return j(this,a)},b.prototype.timeout=function(a,e){a=+a;var f=new b(d);return f._propagateFrom(this,7),f._follow(this),c(h,a,f,e,a),f.cancellable()}}},{"./errors.js":10,"./errors_api_rejection":11,"./util.js":35}],34:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){for(var c=a.length,d=0;c>d;++d){var e=a[d];if(e.isRejected())return b.reject(e.error());a[d]=e.value()}return a}function f(a){setTimeout(function(){throw a},0)}function g(a){var b=d(a,void 0);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function h(a,c){function e(){if(h>=i)return j.resolve();var k=g(a[h++]);if(k instanceof b&&k._isDisposable()){try{k=d(k._getDisposer().tryDispose(c),void 0)}catch(l){return f(l)}if(k instanceof b)return k._then(e,f,null,null,null)}e()}var h=0,i=a.length,j=b.defer();return e(),j.promise}function i(a){var b=new o;return b._settledValue=a,b._bitField=268435456,h(this,b).thenReturn(a)}function j(a){var b=new o;return b._settledValue=a,b._bitField=134217728,h(this,b).thenThrow(a)}function k(a,b){this._data=a,this._promise=b}function l(a,b){this.constructor$(a,b)}var m=a("./errors.js").TypeError,n=a("./util.js").inherits,o=b.PromiseInspection;k.prototype.data=function(){return this._data},k.prototype.promise=function(){return this._promise},k.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},k.prototype.tryDispose=function(a){var b=this.resource(),c=null!==b?this.doDispose(b,a):null;return this._promise._unsetDisposable(),this._data=this._promise=null,c},k.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},n(l,k),l.prototype.doDispose=function(a,b){var c=this.data();
return c.call(a,a,b)},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var d=arguments[a-1];if("function"!=typeof d)return c("fn must be a function");a--;for(var f=new Array(a),g=0;a>g;++g){var h=arguments[g];if(k.isDisposer(h)){var l=h;h=h.promise(),h._setDisposable(l)}f[g]=h}return b.settle(f).then(e).spread(d)._then(i,j,void 0,f,void 0)},b.prototype._setDisposable=function(a){this._bitField=262144|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(262144&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new l(a,this);throw new m}}},{"./errors.js":10,"./util.js":35}],35:[function(a,b,c){"use strict";function d(a,b,c){try{return a.call(b,c)}catch(d){return x.e=d,x}}function e(a,b,c,d){try{return a.call(b,c,d)}catch(e){return x.e=e,x}}function f(a,b,c,d,e){try{return a.call(b,c,d,e)}catch(f){return x.e=f,x}}function g(a,b,c,d,e,f){try{return a.call(b,c,d,e,f)}catch(g){return x.e=g,x}}function h(a,b,c){try{return a.apply(c,b)}catch(d){return x.e=d,x}}function i(a){return"string"==typeof a?a:""+a}function j(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function k(a){return!j(a)}function l(a){return j(a)?new Error(i(a)):a}function m(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function n(a,b,c){if(!u.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function o(a,b,c){if(j(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return u.defineProperty(a,b,d),a}function p(a){throw a}function q(a){try{if("function"==typeof a){var b=u.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(c){return!1}}function r(a){function b(){}return b.prototype=a,b}function s(a){return B.test(a)}function t(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}var u=a("./es5.js"),v=function(){try{var a={};return u.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),w="undefined"==typeof navigator,x={e:{}},y=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},z=function(){return"string"!==this}.call("string"),A=function(){return u.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(g){return c}for(var h=0;h<f.length;++h){var i=f[h];if(!d[i]){d[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&c.push(i)}}a=u.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),B=/^[a-z$_][a-z$_0-9]*$/i,C={isClass:q,isIdentifier:s,inheritedDataKeys:A,getDataPropertyOrDefault:n,thrower:p,isArray:u.isArray,haveGetters:v,notEnumerableProp:o,isPrimitive:j,isObject:k,canEvaluate:w,errorObj:x,tryCatch1:d,tryCatch2:e,tryCatch3:f,tryCatch4:g,tryCatchApply:h,inherits:y,withAppended:m,asString:i,maybeWrapAsError:l,wrapsPrimitiveReceiver:z,toFastProperties:r,filledRange:t};b.exports=C},{"./es5.js":12}],36:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],37:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],38:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],39:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":38,FWaASH:37,inherits:41}],40:[function(a,b){var c,d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=function(a){"use strict";if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!f)return!1;var g;for(g in a);return g===c||d.call(a,g)};b.exports=function g(){"use strict";var a,b,d,e,h,i,j=arguments[0],k=1,l=arguments.length,m=!1;for("boolean"==typeof j?(m=j,j=arguments[1]||{},k=2):("object"!=typeof j&&"function"!=typeof j||j==c)&&(j={});l>k;++k)if(null!=(a=arguments[k]))for(b in a)d=j[b],e=a[b],j!==e&&(m&&e&&(f(e)||(h=Array.isArray(e)))?(h?(h=!1,i=d&&Array.isArray(d)?d:[]):i=d&&f(d)?d:{},j[b]=g(m,i,e)):e!==c&&(j[b]=e));return j}},{}],41:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],42:[function(a,b){function c(){this.emitting=!1,e.call(this)}function d(a,b){var c=!1;if(Array.isArray(a)&&Array.isArray(b))for(var d=0;d<a.length;d++)if(-1!==b.indexOf(a[d])){c=!0;break}return c}var e=a("events").EventEmitter,f=a("util");f.inherits(c,e),c.prototype.emit=function(a){var b=arguments,c=[],f=this;return a=Array.isArray(a)?a:a.split(" "),a.forEach(function(a){var g,h=[],i=[];if(-1!==a.indexOf(".")&&f._events&&(h=a.split("."),a=h.shift(),g=f._events[a]))if(Array.isArray(g)){if(g.forEach(function(a){d(h,a.__eens)&&i.push(a)}),!i.length)return;f._events[a]=i}else if(0==d(h,g.__eens))return;f.emitting={event:a,namespaces:h},b[0]=a,c.push(e.prototype.emit.apply(f,b)),f.emitting=!1,i.length&&(f._events[a]=g)}),1==c.length?c[0]:c},c.prototype.addListener=function(a,b){var c,d;return-1!==(d=a.indexOf("."))&&"function"==typeof b&&(b=b.bind(),c=a.split("."),a=c.shift(),b.__eens=c),e.prototype.addListener.call(this,a,b)},c.prototype.on=function(a,b){var c,d=Array.isArray(a),f=this;"string"==typeof a||d?(a=d?a:a.split(" "),a.forEach(function(a){f.addListener(a,b)})):"object"==typeof a?(c=Object.keys(a),c.forEach(function(b){f.addListener(b,a[b])})):e.prototype.addListener.call(this,a,b)},c.prototype.removeListener=function(a,b){return-1!==a.indexOf(".")&&(a=a.split(".").shift()),e.prototype.removeListener.call(this,a,b)},c.prototype.removeAllListeners=function(a){var b;return-1!==a.indexOf(".")?(b=a.split("."),a=b.shift(),a?this._offNs(b,a):this._events&&Object.keys(this._events).forEach(this._offNs.bind(this,b))):e.prototype.removeAllListeners.call(this,a),this},c.prototype._offNs=function(a,b){var c=this._events&&this._events[b],e=this;c&&(Array.isArray(c)?c.forEach(function(c){d(a,c.__eens)&&e.removeListener(b,c)}):d(a,c.__eens)&&this.removeListener(b,c))},c.prototype.off=function(a,b){var c,d=Array.isArray(a),e=this,f="function"==typeof b;return"string"==typeof a||d?(a=d?a:a.split(" "),a.forEach(function(a){f?e.removeListener(a,b):e.removeAllListeners(a)})):"object"==typeof a&&(c=Object.keys(a),c.forEach(function(b){"function"==typeof a[b]?e.removeListener(b,a[b]):e.removeAllListeners(b)})),this},b.exports=function(a){return a}.bind(null,new c);var g={};b.exports.create=function(a){var b;return b=a&&g[a]?g[a]:new c},b.exports.EventEmitter=c},{events:36,util:39}],43:[function(a,b){b.exports=function(){function b(f){var g=this;if(!(g instanceof b))throw new Error("usage: new Hoodie(url);");g.baseUrl=f?f.replace(/\/+$/,""):"",g.extend=function(a){a(g,d,e)},e.events(g),g.extend(a("./hoodie/id")),g.extend(a("./hoodie/open")),g.extend(a("./hoodie/request")),g.extend(a("./hoodie/connection")),g.extend(a("./hoodie/store")),g.extend(a("./hoodie/account")),g.extend(a("./hoodie/remote")),g.extend(a("./hoodie/task")),g.account.authenticate().then(function(){g.remote.connect()}),c(g)}function c(a){for(var b=0;b<f.length;b++)f[b](a,d,e)}var d=a("./lib"),e=a("./utils"),f=[];return b.extend=function(a){f.push(a)},b}()},{"./hoodie/account":46,"./hoodie/connection":47,"./hoodie/id":48,"./hoodie/open":49,"./hoodie/remote":50,"./hoodie/request":51,"./hoodie/store":55,"./hoodie/task":59,"./lib":65,"./utils":80}],44:[function(a,b,c){(function(b){var d=a("./helpers"),e=a("../../utils"),f=e.generateId,g=e.config,h=e.promise,i=h.reject,j=h.rejectWith,k=h.resolveWith;c.authenticate=function(a){var b=a.requests;return a.authenticated===!1?i():a.authenticated===!0?k(a.username):b.signOut&&"pending"===b.signOut.state?b.signOut.then(i):b.signIn&&"pending"===b.signIn.state?a.requests.signIn:c.hasAccount(a)?d.withSingleRequest(a,"authenticate",function(){return c.request(a,"GET","/_session").then(d.handleAuthenticateRequestSuccess.bind(null,a))}):d.sendSignOutRequest(a).then(function(){return a.authenticated=!1,i()})},c.hasValidSession=function(a){return c.hasAccount(a)?a.authenticated===!0:!1},c.hasInvalidSession=function(a){return c.hasAccount(a)?a.authenticated===!1:!1},c.signUp=function(a,b,e){return void 0===e&&(e=""),b?c.hasAnonymousAccount(a)?d.upgradeAnonymousAccount(a,b,e):c.hasAccount(a)?j("Must sign out first."):d.sendSignUpRequest(a,b,e).done(function(){d.setUsername(a,b),a.events.trigger("signup",b)}):j("Username must be set.")},c.anonymousSignUp=function(a){var b,c;return b=f(10),c=a.hoodie.id(),d.sendSignUpRequest(a,c,b).progress(function(){d.setAnonymousPassword(a,b)}).done(function(){a.events.trigger("signup:anonymous")})},c.hasAccount=function(a){var b=!!a.username;return b||c.hasAnonymousAccount(a)},c.hasAnonymousAccount=function(a){return!!d.getAnonymousPassword(a)},c.signIn=function(a,b,e,f){var g,h,i=b===a.username;b||(b=""),e||(e=""),b=b.toLowerCase(),f=f||{},g=f.silent,h=!c.hasAccount(a)||i||f.moveData?d.sendSignInRequest(a,b,e,f):d.pushLocalChanges(a,f).then(function(){return d.sendSignInRequest(a,b,e,f)}),i||h.done(d.disconnect.bind(null,a)),h.done(function(b){f.moveData&&a.events.trigger("movedata"),i||f.moveData||d.cleanup(a),i?g||a.events.trigger("reauthenticated",b):d.setUsername(a,b),g||a.events.trigger("signin",b,a.newHoodieId,f)})},c.signOut=function(a,b){var e;return b=b||{},e=b.silent?d.cleanup:d.cleanupAndTriggerSignOut,c.hasAccount(a)?b.moveData?d.sendSignOutRequest(a):d.pushLocalChanges(a,b).then(d.disconnect.bind(null,a)).then(d.sendSignOutRequest.bind(null,a)).then(e.bind(null,a)):e(a)},c.request=function(a,b,c,d){return a.hoodie.request.apply(a.hoodie,[b,c,d||{}])},c.db=function(a){return"user/"+a.hoodie.id()},c.fetch=function(a,b){var e=c.hasAnonymousAccount(a)?a.hoodie.id():a.username;return void 0===b&&(b=e),b?d.withSingleRequest(a,"fetch",function(){return c.request(a,"GET",d.userDocUrl(a,b)).done(function(b){return a.userDoc=b,a.userDoc})}):j({name:"HoodieUnauthorizedError",message:"Not signed in"})},c.changePassword=function(a,b,e){return a.username?(d.disconnect(a),c.fetch(a).then(d.sendChangeUsernameAndPasswordRequest(a,b,null,e)).done(function(){a.events.trigger("changepassword")})):j({name:"HoodieUnauthorizedError",message:"Not signed in"})},c.resetPassword=function(a,b){var e,h,i,j;return(j=g.get("_account.resetPasswordId"))?c.checkPasswordReset(a):(j=""+b+"/"+f(),g.set("_account.resetPasswordId",j),h=""+a.userDocPrefix+":$passwordReset/"+j,e={_id:h,name:"$passwordReset/"+j,type:"user",roles:[],password:j,createdAt:d.now(a),updatedAt:d.now(a)},i={data:JSON.stringify(e),contentType:"application/json"},d.withPreviousRequestsAborted(a,"resetPassword",function(){return c.request(a,"PUT","/_users/"+encodeURIComponent(h),i).done(c.checkPasswordReset.bind(null,a)).then(d.awaitPasswordResetResult.bind(null,a)).done(function(){a.events.trigger("resetpassword")})}))},c.checkPasswordReset=function(a){var e,f,h,i,k,l;return(h=g.get("_account.resetPasswordId"))?(k=h.split("/")[0],l="$passwordReset/"+h,i="/_users/"+encodeURIComponent(a.userDocPrefix+":"+l),e=btoa(l+":"+h),f={headers:{Authorization:"Basic "+e}},d.withSingleRequest(a,"passwordResetStatus",function(){return c.request(a,"GET",i,f).then(d.handlePasswordResetStatusRequestSuccess.bind(null,a),d.handlePasswordResetStatusRequestError(a,k)).fail(function(d){return"HoodiePendingError"===d.name?void b.setTimeout(c.checkPasswordReset.bind(null,a),1e3):a.events.trigger("error:passwordreset",d,k)})})):j("No pending password reset.")},c.changeUsername=function(a,b,e){var f=c.hasAnonymousAccount(a)?a.hoodie.id():a.username;return e!==f?(e=e||"",c.changeUsernameAndPassword(a,b,e.toLowerCase()).done(function(){d.setUsername(a,e),a.events.trigger("changeusername",e)})):j({name:"HoodieConflictError",message:"Usernames identical"})},c.destroy=function(a){return c.hasAccount(a)?c.fetch(a).then(d.handleFetchBeforeDestroySuccess.bind(null,a),d.handleFetchBeforeDestroyError.bind(null,a)).then(d.cleanupAndTriggerSignOut.bind(null,a)):d.cleanupAndTriggerSignOut(a)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":80,"./helpers":45}],45:[function(a,b,c){(function(b){var d=a("extend"),e=a("../../utils"),f=e.config,g=e.promise,h=g.defer,i=g.reject,j=g.rejectWith,k=g.resolveWith,l=g.resolve,m="_account.anonymousPassword";c.setAnonymousPassword=function(a,b){return f.set(m,b)},c.getAnonymousPassword=function(){return f.get(m)},c.removeAnonymousPassword=function(){return f.unset(m)},c.anonymousSignIn=function(a){var b=a.hoodie.id(),d=c.getAnonymousPassword(a);return a.hoodie.account.signIn(b,d).done(function(){a.events.trigger("signin:anonymous",b)})},c.reauthenticate=function(a){return a.authenticated=void 0,c.authenticate()},c.setUsername=function(a,b){return a.username!==b?(a.username=b,f.set("_account.username",b)):void 0},c.handleAuthenticateRequestSuccess=function(a,b){return b.userCtx.name?(a.authenticated=!0,k(a.username)):a.hoodie.account.hasAnonymousAccount()?c.anonymousSignIn(a):(a.authenticated=!1,a.events.trigger("error:unauthenticated"),i())},c.handleSignUpSuccess=function(a,b,d){return function(e){return a.userDoc._rev=e.rev,c.delayedSignIn(a,b,d)}},c.handleSignUpError=function(a,b){return function(a){return"HoodieConflictError"===a.name&&(a.message="Username "+b+" already exists"),j(a)}},c.delayedSignIn=function(a,d,e,f,g){return g||(g=h()),b.setTimeout(function(){var b=c.sendSignInRequest(a,d,e,f);b.done(g.resolve),b.fail(function(b){"HoodieAccountUnconfirmedError"===b.name?c.delayedSignIn(a,d,e,f,g):g.reject.apply(g,arguments)})},300),g.promise},c.handleSignInSuccess=function(a,b){return b=b||{},function(b){var c,d;return c=b.name.replace(/^user(_anonymous)?\//,""),d=b.roles[0],-1!==b.roles.indexOf("error")?a.hoodie.account.fetch(c).then(function(){return j(a.userDoc.$error)}):-1===b.roles.indexOf("confirmed")?j({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(a.authenticated=!0,a.newHoodieId=d,a.hoodie.account.fetch(c),k(c))}},c.handlePasswordResetStatusRequestSuccess=function(a,b){var c;return b.$error?(c=b.$error,c.object=b,delete c.object.$error):c={name:"HoodiePendingError",message:"Password reset is still pending"},j(c)},c.handlePasswordResetStatusRequestError=function(a,b){return function(c){return"HoodieUnauthorizedError"===c.name?(f.unset("_account.resetPasswordId"),a.events.trigger("passwordreset",b),l()):j(c)}},c.awaitPasswordResetResult=function(a){var b=h();return a.events.once("passwordreset",b.resolve),a.events.on("error:passwordreset",c.removePasswordResetObject.bind(null,a)),a.events.on("error:passwordreset",b.reject),b.always(function(){a.events.removeListener("passwordreset",b.resolve),a.events.removeListener("error:passwordreset",c.removePasswordResetObject.bind(null,a)),a.events.removeListener("error:passwordreset",b.reject)}),b.promise},c.removePasswordResetObject=function(a,b){var c=b.object,d=c.name,e=d.substr(15),g="/_users/"+encodeURIComponent(a.userDocPrefix+":"+d),h=btoa(d+":"+e);c._deleted=!0;var i={headers:{Authorization:"Basic "+h},contentType:"application/json",data:JSON.stringify(c)};a.hoodie.account.request("PUT",g,i),f.unset("_account.resetPasswordId")},c.changeUsernameAndPassword=function(a,b,d,e){var f=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;return c.sendSignInRequest(a,f,b).then(function(){return a.hoodie.account.fetch().then(c.sendChangeUsernameAndPasswordRequest(a,b,d,e))})},c.upgradeAnonymousAccount=function(a,b,d){var e=c.getAnonymousPassword(a);return c.changeUsernameAndPassword(a,e,b,d).done(function(){a.events.trigger("signup",b),c.removeAnonymousPassword(a)})},c.handleFetchBeforeDestroySuccess=function(a){return c.disconnect(),a.userDoc._deleted=!0,c.withPreviousRequestsAborted(a,"updateUsersDoc",function(){a.hoodie.account.request("PUT",c.userDocUrl(),{data:JSON.stringify(a.userDoc),contentType:"application/json"})})},c.handleFetchBeforeDestroyError=function(a,b){return"HoodieNotFoundError"===b.name?l():j(b)},c.cleanup=function(a){return a.events.trigger("cleanup"),a.authenticated=void 0,c.setUsername(a,void 0),l()},c.disconnect=function(a){return a.hoodie.remote.disconnect()},c.cleanupAndTriggerSignOut=function(a){var b=a.username;return c.cleanup(a).then(function(){return a.events.trigger("signout",b)})},c.userTypeAndId=function(a,b){var c;return c=b===a.hoodie.id()?"user_anonymous":"user",""+c+"/"+b},c.userDocKey=function(a,b){var d=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;return b=b||d,""+a.userDocPrefix+":"+c.userTypeAndId(a,b)},c.userDocUrl=function(a,b){return"/_users/"+encodeURIComponent(c.userDocKey(a,b))},c.sendChangeUsernameAndPasswordRequest=function(a,b,e,f){return function(){var g=d({},a.userDoc);e&&(g.$newUsername=e),g.updatedAt=c.now(a),g.signedUpAt=g.signedUpAt||c.now(a),void 0!==f&&(delete g.salt,delete g.password_sha,g.password=f);var h={data:JSON.stringify(g),contentType:"application/json"};return c.withPreviousRequestsAborted(a,"updateUsersDoc",function(){return a.hoodie.account.request("PUT",c.userDocUrl(a),h).then(c.handleChangeUsernameAndPasswordResponse(e,f||b))})}},c.handleChangeUsernameAndPasswordResponse=function(a,b,d){var e=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;return function(){return c.disconnect(a),b?c.awaitCurrentAccountRemoved(a,e,d).then(function(){return a.hoodie.account.signOut({silent:!0,moveData:!0}).then(function(){return a.hoodie.account.signIn(b,d,{moveData:!0,silent:!0})})}):a.hoodie.account.signIn(e,d,{silent:!0})}},c.awaitCurrentAccountRemoved=function(a,d,e,f){f||(f=h());var g={data:{name:c.userTypeAndId(a,d),password:e}};return c.withPreviousRequestsAborted(a,"signIn",function(){return a.hoodie.account.request("POST","/_session",g)}).done(function(){b.setTimeout(c.awaitCurrentAccountRemoved.bind(null,a),300,d,e,f)}).fail(function(a){return 401===a.status?f.resolve():void f.reject(a)}),f.promise},c.withPreviousRequestsAborted=function(a,b,c){return void 0!==a.requests[b]&&"function"==typeof a.requests[b].abort&&a.requests[b].abort(),a.requests[b]=c(),a.requests[b]},c.withSingleRequest=function(a,b,c){return a.requests[b]&&"pending"===a.requests[b].state?a.requests[b]:(a.requests[b]=c(),a.requests[b].state="pending",a.requests[b].then(function(){a.requests[b].state="fullfiled"},function(){a.requests[b].state="rejected"}),a.requests[b])},c.pushLocalChanges=function(a,b){return a.hoodie.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.hoodie.remote.push():l()},c.sendSignOutRequest=function(a){return c.withSingleRequest(a,"signOut",function(){return a.hoodie.account.request("DELETE","/_session")})},c.sendSignInRequest=function(a,b,d,e){var f={data:{name:c.userTypeAndId(a,b),password:d}};return c.withPreviousRequestsAborted(a,"signIn",function(){var b=a.hoodie.account.request("POST","/_session",f);return b.then(c.handleSignInSuccess(a,e))})},c.sendSignUpRequest=function(a,b,d){var e,f=h();return b=b.toLowerCase(),e={data:JSON.stringify({_id:c.userDocKey(a,b),name:c.userTypeAndId(a,b),type:"user",roles:[],password:d,hoodieId:a.hoodie.id(),database:a.hoodie.account.db(),updatedAt:c.now(a),createdAt:c.now(a),signedUpAt:b!==a.hoodie.id()?c.now(a):void 0}),contentType:"application/json"},a.hoodie.account.request("PUT",c.userDocUrl(a,b),e).done(f.notify).then(c.handleSignUpSuccess(a,b,d),c.handleSignUpError(a,b)).then(f.resolve,f.reject),f.promise},c.now=function(){return new Date}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":80,extend:40}],46:[function(a,b){var c=a("../../utils"),d=a("./api"),e=a("./helpers");b.exports=function(a){var b={},f=c.config.get("_account.username"),g={authenticated:null,events:c.events(a,b,"account"),hoodie:a,requests:{},userDoc:{},userDocPrefix:"org.couchdb.user",get username(){return f},set username(a){f=a,b.username=a}};Object.keys(d).forEach(function(a){"function"==typeof d[a]&&(b[a]=d[a].bind(null,g))}),a.on("remote:error:unauthenticated",e.reauthenticate.bind(null,g)),b.on("cleanup",c.config.clear),b.checkPasswordReset(),a.account=b}},{"../../utils":80,"./api":44,"./helpers":45}],47:[function(a,b){(function(c){var d=a("../utils/promise"),e=b.exports=function(a){var b={online:!0,checkConnectionRequest:null,checkConnectionTimeout:null,hoodie:a};a.checkConnection=e.checkConnection.bind(null,b),a.isConnected=e.isConnected.bind(null,b),c.addEventListener("online",a.checkConnection,!1),c.addEventListener("offline",a.checkConnection,!1),a.checkConnection()};e.checkConnection=function(a){if(a.checkConnectionRequest)return a.checkConnectionRequest;var b="/?hoodieId="+a.hoodie.id();return c.clearTimeout(a.checkConnectionTimeout),a.checkConnectionRequest=a.hoodie.request("GET",b).then(e.handleConnection.bind(null,a,3e4,"reconnected",!0),e.handleConnection.bind(null,a,3e3,"disconnected",!1)),a.checkConnectionRequest
},e.isConnected=function(a){return a&&a.online},e.handleConnection=function(a,b,f,g){return a.checkConnectionRequest=void 0,a.checkConnectionTimeout=c.setTimeout(e.checkConnection.bind(null,a),b),e.isConnected(a)!==g&&(a.hoodie.trigger(f),a.online=g),d[g?"resolve":"reject"]()}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/promise":83}],48:[function(a,b,c){var d=a("../utils"),e=d.generateId,f=d.config,c=b.exports=function(a){var b={id:f.get("_hoodieId")};b.id||(b.id=f.get("_account.ownerHash")),a.on("account:cleanup",c.unsetId.bind(null,b)),a.on("account:signin",function(a,d){c.setId(b,d)}),a.on("account:signin:anonymous",c.setId.bind(null,b)),a.id=c.id.bind(null,b)};c.id=function(a){return a.id||c.setId(a,e()),a.id},c.setId=function(a,b){a.id=b,f.set("_hoodieId",a.id)},c.unsetId=function(a){delete a.id,f.unset("_hoodieId")}},{"../utils":80}],49:[function(a,b,c){var d=a("../lib/store/remote"),e=a("extend"),c=b.exports=function(a){a.open=c.open.bind(null,a)};c.open=function(a,b,c){return c=c||{},e(c,{name:b}),d(a,c)}},{"../lib/store/remote":72,extend:40}],50:[function(a,b,c){var d=a("../utils"),e=d.config,f=d.promise.rejectWith,c=b.exports=function(a){var b=a.open(a.account.db(),{connected:!0,prefix:"",since:c.sinceNrCallback,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})});b.connect=c.connect.bind(null,a,b.connect),b.trigger=c.trigger.bind(null,a),b.on=c.on.bind(null,a),b.unbind=c.unbind.bind(null,a),a.on("remote:connect",function(){a.on("store:idle",b.push)}),a.on("remote:disconnect",function(){a.unbind("store:idle",b.push)}),a.on("disconnected",b.disconnect),a.on("reconnected",b.connect),a.on("account:signup",b.connect),a.on("account:signup:anonymous",b.connect),a.on("account:signin",b.connect),a.on("account:signin:anonymous",b.connect),a.on("account:changeusername",b.connect),a.on("account:reauthenticated",b.connect),a.on("account:signout",b.disconnect),a.remote=b};c.connect=function(a,b){return a.account.hasAccount()?b(a.account.db()):f("User has no database to connect to")},c.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);return b[0]="remote:"+b[0],a.trigger.apply(a,b)},c.on=function(a,b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},c.unbind=function(a,b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},c.sinceNrCallback=function(a){return a?e.set("_remote.since",a):e.get("_remote.since")||0}},{"../utils":80}],51:[function(a,b){(function(c){var d=a("extend"),e=a("../utils"),f=e.hoodiefyRequestErrorName,g=e.promise.defer,h=e.promise.rejectWith,i=c.jQuery.ajax,j=b.exports=function(a){a.request=j.request.bind(null,a)},k="/_api";j.request=function(a,b,c,e){var f,h={type:b,dataType:"json"},l=g(),m=l.promise;e=e||{},/^http/.test(c)||(c=(a.baseUrl||"")+k+c),/^http/.test(c)&&(h.xhrFields={withCredentials:!0},h.crossDomain=!0),h.url=c,f=i(d(h,e)).done(l.resolve).fail(l.reject);var n=m.then(null,j.handleRequestError.bind(null,a));return n.abort=f.abort,n},j.handleRequestError=function(a,b){var c;if("abort"===b.statusText)return h({name:"HoodieConnectionAbortError",message:"Request has been aborted"});try{c=j.parseErrorFromResponse(b)}catch(d){c=b&&b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return h(c)},j.HTTP_STATUS_ERROR_MAP={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"},j.parseErrorFromResponse=function(a){var b=JSON.parse(a.responseText);return b.name=j.HTTP_STATUS_ERROR_MAP[a.status],b.name||(b.name=f(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":80,extend:40}],52:[function(a,b){(function(c){var d=a("../../utils"),e=d.promise,f=e.defer,g=d.localStorageWrapper,h=a("./helpers"),i=b.exports;i.index=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=g.length();f>=0?f>e:e>f;b=f>=0?++e:--e)c=g.key(b),h.isSemanticKey(a,c)&&d.push(c);return d},i.changedObjects=function(a){var b,c,d,e,f,g,h;f=a.dirty,h=[];for(c in f)f.hasOwnProperty(c)&&(d=f[c],g=c.split("/"),e=g[0],b=g[1],d.type=e,d.id=b,h.push(d));return h},i.hasLocalChanges=function(a,b,d){if(!b)return!c.$.isEmptyObject(a.dirty);var e=[b,d].join("/");return a.dirty[e]?!0:h.hasLocalChanges(a,h.cache(a,b,d))},i.clear=function(a){var b,c,d,e;b=f();try{d=i.index(a),e=function(){var b,e,f;for(f=[],b=0,e=d.length;e>b;b++)c=d[b],h.isSemanticKey(a,c)&&f.push(g.removeItem(c));return f}.call(this),a.cachedObject={},h.clearChanged(a),b.resolve(),a.hoodie.store.trigger("clear")}catch(j){b.reject(j)}return b.promise},i.isBootstrapping=function(a){return a.bootstrapping},i.isPersistent=function(){return g.isPersistent}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":80,"./helpers":54}],53:[function(a,b,c){var d=a("./localstore"),c=b.exports;c.start=function(a){a.bootstrapping=!0,a.hoodie.store.trigger("bootstrap:start")},c.end=function(a){var b,c,e,f;for(a.bootstrapping=!1;a.queue.length>0;)b=a.queue.shift(),c=b[0],e=b[1],f=b[2],d[c].bind(d,a).apply(d,e).then(f.resolve,f.reject);a.hoodie.store.trigger("bootstrap:end")},c.abort=function(a,b){var c,d;for(a.bootstrapping=!1;a.queue.length>0;)c=a.queue.shift(),d=c[2],d.reject(b);a.hoodie.store.trigger("bootstrap:error",b)}},{"./localstore":56}],54:[function(a,b){(function(c){var d=a("extend"),e=a("../../utils"),f=e.promise,g=f.defer,h=e.localStorageWrapper,i=b.exports;i.cache=function(a,b,c,e,f){var g,j;if(void 0===e&&(e=!1),f=f||{},g=""+b+"/"+c,e){if(d(e,{type:b,id:c}),j=d({},e),delete j.type,delete j.id,h.setObject(g,j),f.remote)return i.clearChanged(a,b,c),a.cachedObject[g]=d(!0,{},e),a.cachedObject[g]}else{if(a.cachedObject[g]===!1)return!1;if(a.cachedObject[g])return d(!0,{},a.cachedObject[g]);if(g=""+b+"/"+c,e=h.getObject(g),!e)return i.clearChanged(a,b,c),a.cachedObject[g]=!1,!1;e.type=b,e.id=c}return i.isMarkedAsDeleted(a,e)?(i.markAsChanged(a,b,c,e,f),a.cachedObject[g]=!1,!1):(a.cachedObject[g]=d(!0,{},e),i.hasLocalChanges(a,e)?i.markAsChanged(a,b,c,a.cachedObject[g],f):i.clearChanged(a,b,c),d(!0,{},e))},i.markAsChanged=function(a,b,c,d,e){var f;e=e||{},f=""+b+"/"+c,a.dirty[f]=d,i.saveDirtyIds(a),e.silent||i.triggerDirtyAndIdleEvents(a)},i.clearChanged=function(a,b,d){var e;return b&&d?(e=""+b+"/"+d,delete a.dirty[e]):a.dirty={},i.saveDirtyIds(a),c.clearTimeout(a.dirtyTimeout)},i.markAllAsChanged=function(a){return a.hoodie.store.findAll().done(function(b){var c,d,e,f;for(e=0,f=b.length;f>e;e++)d=b[e],c=""+d.type+"/"+d.id,a.dirty[c]=d;i.saveDirtyIds(a),i.triggerDirtyAndIdleEvents(a)})},i.handleRemoteChange=function(a,b,c){"remove"===b?a.hoodie.store.remove(c.type,c.id,{remote:!0,update:c}):a.hoodie.store.save(c.type,c.id,c,{remote:!0})},i.handlePushedObject=function(a,b){i.triggerEvents(a,"sync",b),b._deleted?a.hoodie.store.remove(b.type,b.id,{remote:!0,silent:!0}):a.hoodie.store.save(b.type,b.id,b,{remote:!0,silent:!0})},i.saveDirtyIds=function(a){if(c.$.isEmptyObject(a.dirty))h.removeItem("_dirty");else{var b=Object.keys(a.dirty);h.setItem("_dirty",b.join(","))}},i.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")},i.SEMANTIC_ID_PATTERN=new RegExp(/^[a-z$][a-z0-9-]+\/[a-z0-9]+$/),i.isSemanticKey=function(a,b){return i.SEMANTIC_ID_PATTERN.test(b)},i.hasLocalChanges=function(a,b){return b.updatedAt?b._syncedAt?b._syncedAt<b.updatedAt:!0:!1},i.isMarkedAsDeleted=function(a,b){return b._deleted===!0},i.triggerEvents=function(a,b,c,e){a.hoodie.store.trigger(b,d(!0,{},c),e),a.hoodie.store.trigger(c.type+":"+b,d(!0,{},c),e),a.hoodie.store.trigger(b+":"+c.type,d(!0,{},c),e),"new"!==b&&(a.hoodie.store.trigger(c.type+":"+c.id+":"+b,d(!0,{},c),e),a.hoodie.store.trigger(b+":"+c.type+":"+c.id,d(!0,{},c),e)),"sync"!==b&&(a.hoodie.store.trigger("change",b,d(!0,{},c),e),a.hoodie.store.trigger(c.type+":change",b,d(!0,{},c),e),a.hoodie.store.trigger("change:"+c.type,b,d(!0,{},c),e),"new"!==b&&(a.hoodie.store.trigger(c.type+":"+c.id+":change",b,d(!0,{},c),e),a.hoodie.store.trigger("change:"+c.type+":"+c.id,b,d(!0,{},c),e)))},i.triggerDirtyAndIdleEvents=function(a){a.hoodie.store.trigger("dirty"),c.clearTimeout(a.dirtyTimeout),a.dirtyTimeout=c.setTimeout(function(){a.hoodie.store.trigger("idle",a.hoodie.store.changedObjects())},a.idleTimeout)},i.enqueue=function(a,b,c){var d=g();return a.queue.push([b,c,d]),d.promise},i.moveData=function(a){var b,c=[];a.hoodie.store.findAll().done(function(d){c=d,c.length&&(b=a.hoodie.id(),a.hoodie.once("account:signin",function(d,e){c.forEach(function(c){c.createdBy===b&&(c.createdBy=e),c=i.cache(a,c.type,c.id,c),i.markAsChanged(a.object.type,c.id,c,{silent:!0})}),i.triggerDirtyAndIdleEvents(a)}))})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":80,extend:40}],55:[function(a,b,c){var d=a("../../lib/store/api"),e=a("../../lib/error/object_type"),f=a("../../lib/error/object_id"),g=a("./api"),h=a("./bootstrap"),i=a("./helpers"),j=a("./localstore"),k=a("../../utils").localStorageWrapper,c=b.exports=function(a){var b={bootstrapping:!1,cachedObject:{},dirtyTimeout:void 0,dirty:{},hoodie:a,queue:[],idleTimeout:2e3},e=d(a,{validate:c.validate,backend:{save:j.save.bind(null,b),find:j.find.bind(null,b),findAll:j.findAll.bind(null,b),remove:j.remove.bind(null,b),removeAll:j.removeAll.bind(null,b)}});Object.keys(g).forEach(function(a){"function"==typeof g[a]&&(e[a]=g[a].bind(null,b))}),a.on("account:signup",i.markAllAsChanged.bind(null,b)),a.on("account:movedata",i.moveData.bind(null,b)),a.on("account:cleanup",g.clear.bind(null,b)),a.on("remote:bootstrap:start",h.start.bind(null,b)),a.on("remote:bootstrap:end",h.end.bind(null,b)),a.on("remote:bootstrap:error",h.abort.bind(null,b)),a.on("remote:change",i.handleRemoteChange.bind(null,b)),a.on("remote:push",i.handlePushedObject.bind(null,b)),a.store=e,c.bootstrapDirtyObjects(b)};c.bootstrapDirtyObjects=function(a){var b=k.getItem("_dirty");if(b){b=b.split(",");for(var c=0;c<b.length;c++){var d=b[c].split("/");i.cache(a,d[0],d[1])}}},c.validate=function(a){if(e.isInvalid(a.type))return new e({type:a.type});if(a.id)return f.isInvalid(a.id)?new f({id:a.id}):void 0}},{"../../lib/error/object_id":62,"../../lib/error/object_type":63,"../../lib/store/api":68,"../../utils":80,"./api":52,"./bootstrap":53,"./helpers":54,"./localstore":56}],56:[function(a,b,c){var d=a("./helpers"),e=a("../../utils"),f=e.generateId,g=e.localStorageWrapper,h=e.promise,i=h.defer,j=h.rejectWith,k=h.resolveWith;c.save=function(a,b,c){var e,g,h,j,k,l;if(c=c||{},a.hoodie.store.isBootstrapping(a)&&!c.remote)return d.enqueue(a,"save",arguments);if(b.id?(e=d.cache(a,b.type,b.id),k="object"!=typeof e):(k=!0,b.id=f()),k?b.createdBy=b.createdBy||a.hoodie.id():e.createdBy&&(b.createdBy=e.createdBy),!k)for(l in e)if(!b.hasOwnProperty(l))switch(l.charAt(0)){case"_":c.remote&&(b[l]=e[l]);break;case"$":c.remote||(b[l]=e[l])}c.remote?b._syncedAt=d.now(a):c.silent||(b.updatedAt=d.now(a),b.createdAt=b.createdAt||b.updatedAt),c.local?b._$local=!0:delete b._$local,g=i();try{b=d.cache(a,b.type,b.id,b,c),g.resolve(b,k),j=k?"add":"update",c.silent||d.triggerEvents(a,j,b,c)}catch(m){h=m,g.reject(h.toString())}return g.promise},c.find=function(a,b,c){var e,f;if(a.hoodie.store.isBootstrapping())return d.enqueue(a,"find",arguments);try{return f=d.cache(a,b,c),f?k(f):j({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found'})}catch(g){return e=g,j(e)}},c.findAll=function(a,b){var c,e,f,g,h,j,k,l,m;if(null==b&&(b=function(){return!0}),a.hoodie.store.isBootstrapping())return d.enqueue(a,"findAll",arguments);j=a.hoodie.store.index(),"string"==typeof b&&(m=b,b=function(a){return a.type===m}),e=i();try{l=function(){var e,f,i,l;for(l=[],e=0,f=j.length;f>e;e++)h=j[e],d.isSemanticKey(a,h)&&(i=h.split("/"),c=i[0],g=i[1],k=d.cache(a,c,g),k&&b(k)&&l.push(k));return l}.call(this),l.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),e.resolve(l)}catch(n){f=n,e.reject(f)}return e.promise},c.remove=function(a,b,c,e){var f,h,i;return e=e||{},a.hoodie.store.isBootstrapping()&&!e.remote?d.enqueue(a,"remove",arguments):(f=b+"/"+c,h=d.cache(a,b,c),e.update&&(h=e.update,delete e.update),e.remote&&(g.removeItem(f),i=a.cachedObject[f]&&d.isMarkedAsDeleted(a,a.cachedObject[f]),a.cachedObject[f]=!1,d.clearChanged(a,b,c),h)?(i||d.triggerEvents(a,"remove",h,e),k(h)):h?(h._syncedAt?(h._deleted=!0,d.cache(a,b,c,h)):(f=b+"/"+c,g.removeItem(f),a.cachedObject[f]=!1,d.clearChanged(a,b,c)),d.triggerEvents(a,"remove",h,e),k(h)):j({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}"" could not be found'}))},c.removeAll=function(a,b,c){return a.hoodie.store.findAll(b).then(function(b){var d,e,f,g;for(g=[],e=0,f=b.length;f>e;e++)d=b[e],g.push(a.hoodie.store.remove(d.type,d.id,c));return g})}},{"../../utils":80,"./helpers":54}],57:[function(a,b,c){var d=a("extend"),e=a("./helpers"),c=b.exports;c.start=function(a,b,d){return a.hoodie.account.hasAccount()?a.hoodie.store.add("$"+b,d).then(e.handleNewTask.bind(null,a)):a.hoodie.account.anonymousSignUp().then(function(){return c.start(a,b,d)})},c.abort=function(a,b,c){return a.hoodie.store.update("$"+b,c,{abortedAt:e.now(a)}).then(e.handleAbortedTaskObject.bind(null,a))},c.restart=function(a,b,e,f){var g=function(b){return d(b,f),delete b.$error,delete b.$processedAt,delete b.abortedAt,c.start(a,b.type,b)};return c.abort(a,b,e).then(g)},c.abortAll=function(a,b){return e.findAll(a,b).then(e.abortTaskObjects.bind(null,a))},c.restartAll=function(a,b,c){return"object"==typeof b&&(c=b),e.findAll(a,b).then(function(b){e.restartTaskObjects(a,b,c)})}},{"./helpers":58,extend:40}],58:[function(a,b,c){var d=a("../../lib"),e=d.error.error,f=a("../../utils"),g=f.promise.defer,h=a("extend"),c=b.exports;c.handleNewTask=function(a,b){var c=g(),d=a.hoodie.store(b.type,b.id);return d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c.resolve(a):void c.reject(new e({message:"Task has been aborted",task:a}))}),d.on("update",function(b){var d=b.$error;b.$error&&(b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",c.reject(new e(d)),a.hoodie.store.remove("$"+b.type,b.id))}),c},c.handleAbortedTaskObject=function(a,b){var c,d=b.type,e=b.id,f=a.hoodie.store.remove(d,e);return b._rev?(c=g(),a.hoodie.once("store:sync:"+d+":"+e,c.resolve),f.fail(c.reject),c):f},c.handleStoreChange=function(a,b,d,e){"$"===d.type[0]&&(d.type=d.type.substr(1),c.triggerEvents(a,b,d,e))},c.findAll=function(a,b){var c,d="$";return b&&(d+=b),c=function(a){return 0===a.type.indexOf(d)},a.hoodie.store.findAll(c)},c.abortTaskObjects=function(a,b){return b.map(function(b){return a.hoodie.task.abort(b.type.substr(1),b.id)})},c.restartTaskObjects=function(a,b,c){return b.map(function(b){return a.hoodie.task.restart(b.type.substr(1),b.id,c)})},c.triggerEvents=function(a,b,c,d){var e;return"add"===b&&(b="start"),"remove"===b&&c.abortedAt&&(b="abort"),"remove"===b&&c.$processedAt&&!c.$error&&(b="success"),"update"===b&&c.$error?(b="error",e=c.$error,delete c.$error,a.events.trigger("error",e,c,d),a.events.trigger(c.type+":error",e,c,d),a.events.trigger(c.type+":"+c.id+":error",e,c,d),d=h({},d,{error:e}),a.events.trigger("change","error",c,d),a.events.trigger(c.type+":change","error",c,d),void a.events.trigger(c.type+":"+c.id+":change","error",c,d)):void(("start"===b||"abort"===b||"success"===b)&&(a.events.trigger(b,c,d),a.events.trigger(c.type+":"+b,c,d),"start"!==b&&a.events.trigger(c.type+":"+c.id+":"+b,c,d),a.events.trigger("change",b,c,d),a.events.trigger(c.type+":change",b,c,d),"start"!==b&&a.events.trigger(c.type+":"+c.id+":change",b,c,d)))},c.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")}},{"../../lib":65,"../../utils":80,extend:40}],59:[function(a,b,c){var d=a("../../lib"),e=a("../../utils"),f=a("./api"),g=a("./helpers"),c=b.exports=function(a){var b,d=function(){return b.apply(null,arguments)};b=c.scopedTask.bind(null,a,d);var h={events:e.events(a,d,"task"),hoodie:a};Object.keys(f).forEach(function(a){"function"==typeof f[a]&&(d[a]=f[a].bind(null,h))}),a.task=d,a.on("store:change",g.handleStoreChange.bind(null,h))};c.scopedTask=function(a,b,c,e){return d.task.scoped(a,b,{type:c,id:e})}},{"../../lib":65,"../../utils":80,"./api":57,"./helpers":58}],60:[function(a,b){var c=a("extend");b.exports=function(){function a(a){"string"==typeof a&&(a={message:a}),a.message||(a.message="Something went wrong"),a.name||(a.name="HoodieError"),a.message=a.message.replace(b,function(b){var c=b.match(d)[0];return a[c]}),c(this,a)}var b=/\{\{\s*\w+\s*\}\}/g,d=/\w+/;return a.prototype=new Error,a.prototype.constructor=a,a}()},{extend:40}],61:[function(a,b){b.exports={error:a("./error"),objectId:a("./object_id"),objectType:a("./object_type")}},{"./error":60,"./object_id":62,"./object_type":63}],62:[function(a,b){var c=a("./error"),d=a("./validation");b.exports=function(){function a(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new c(a)}var b=/^[a-z0-9\-]+$/;return a.isValid=d.isValid.bind(null,b),a.isInvalid=d.isInvalid.bind(null,b),a.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",a}()},{"./error":60,"./validation":64}],63:[function(a,b){var c=a("./error"),d=a("./validation");b.exports=function(){function a(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',new c(a)}var b=/^[a-z$][a-z0-9-]+$/;return a.isValid=d.isValid.bind(null,b),a.isInvalid=d.isInvalid.bind(null,b),a.prototype.rules="lowercase letters, numbers and dashes allowed only. Must start with a letter",a}()},{"./error":60,"./validation":64}],64:[function(a,b,c){c.isValid=function(a,b,c){return(c||a).test(b||"")},c.isInvalid=function(){return!c.isValid.apply(null,arguments)}},{}],65:[function(a,b){b.exports={error:a("./error"),store:a("./store"),task:a("./task")}},{"./error":61,"./store":69,"./task":75}],66:[function(a,b,c){var d=a("extend"),e=a("./helpers"),f=a("../../../utils"),g=f.promise,h=g.defer,i=g.rejectWith,j=g.resolveWith,k=g.isPromise;c.save=function(a,b,c,f,g){g=g?d(!0,{},g):{};var h=d(!0,{},f,{type:b,id:c}),j=a.validate(h,g||{});return j?i(j):e.decoratePromise(a,a.backend.save(h,g||{}))},c.add=function(a,b,d,e){return void 0===d&&(d={}),e=e||{},c.save(a,b,d.id,d,e)},c.find=function(a,b,c){return e.decoratePromise(a,a.backend.find(b,c))},c.findOrAdd=function(a,b,f,g){function h(){var e;return e=d(!0,{id:f},g),c.add(a,b,e)}null===g&&(g={});var i=c.find(a,b,f).then(null,h);return e.decoratePromise(a,i)},c.findAll=function(a,b,c){return e.decoratePromise(a,a.backend.findAll(b,c))},c.update=function(a,b,f,g,h){function i(e){var i,k,l;return k=d(!0,{},e),"function"==typeof g&&(g=g(k)),g?(i=function(){var a=[];for(var b in g)if(g.hasOwnProperty(b)){if(l=g[b],e[b]===l)continue;k[b]=l,a.push(b)}return a}(),i.length||h?c.save(a,b,f,k,h):j(k)):j(e)}var k=c.find(a,b,f).then(i);return e.decoratePromise(a,k)},c.updateOrAdd=function(a,b,f,g,h){function i(){var e=d(!0,{},g,{id:f});return c.add(a,b,e,h)}var j=c.update(a,b,f,g,h).then(null,i);return e.decoratePromise(a,j)},c.updateAll=function(a,b,d,f){var g;switch(f=f||{},!0){case"string"==typeof b:g=c.findAll(a,b);break;case k(b):g=b;break;case $.isArray(b):g=h().resolve(b);break;default:g=c.findAll(a)}return g=g.then(function(b){var e,g;return $.isArray(b)||(b=[b]),g=function(){var g,h,i;for(i=[],g=0,h=b.length;h>g;g++)e=b[g],i.push(c.update(a,e.type,e.id,d,f));return i}(),$.when.apply(null,g).then(function(){return Array.prototype.slice.call(arguments)})}),e.decoratePromise(a,g)},c.remove=function(a,b,c,d){return e.decoratePromise(a,a.backend.remove(b,c,d||{}))},c.removeAll=function(a,b,c){return e.decoratePromise(a,a.backend.removeAll(b,c||{}))},c.decoratePromises=function(a,b){return d(a.promiseApi,b)}},{"../../../utils":80,"./helpers":67,extend:40}],67:[function(a,b,c){var d=a("extend"),e=a("../../error"),f=e.error,g=e.objectType,h=e.objectId,c=b.exports;c.decoratePromise=function(a,b){return d(b,a.promiseApi)},c.validIdOrTypePattern=/^[^\/]+$/,c.validIdOrTypeRules="/ not allowed",c.defaultValidate=function(a){if(!a)return new f({name:"InvalidObjectError",message:"No object passed."});if(g.isInvalid(a.type,c.validIdOrTypePattern))return new g({type:a.type,rules:c.validIdOrTypeRules});if(a.id)return h.isInvalid(a.id,c.validIdOrTypePattern)?new h({id:a.id,rules:c.validIdOrTypeRules}):void 0}},{"../../error":61,extend:40}],68:[function(a,b){var c=a("../scoped"),d=a("extend"),e=a("../../../utils"),f=a("./helpers"),g=a("./api");b.exports=function(a,b){var h={backend:{},hoodie:a,storeName:b.name||"store",promiseApi:{hoodie:a}},i=function(e,f){var g=d(!0,{type:e,id:f},b);return c(a,i,g)};if(h.events=e.events(a,i,h.storeName),i.validate=h.validate=f.defaultValidate.bind(null,h),"function"==typeof b.validate&&(i.validate=h.validate=b.validate),!b.backend)throw new Error("options.backend must be passed");return["save","find","findAll","remove","removeAll"].forEach(function(a){if(!b.backend[a])throw new Error("options.backend."+a+" must be passed.");h.backend[a]=b.backend[a]}),Object.keys(g).forEach(function(a){"function"==typeof g[a]&&(i[a]=g[a].bind(null,h))}),i}},{"../../../utils":80,"../scoped":74,"./api":66,"./helpers":67,extend:40}],69:[function(a,b){b.exports={api:a("./api"),remote:a("./remote"),scoped:a("./scoped")}},{"./api":68,"./remote":72,"./scoped":74}],70:[function(a,b){(function(c){var d=a("extend"),e=a("../../../utils"),f=e.promise.resolveWith,g=a("./helpers"),h=b.exports;h.request=function(a,b,c,d){return d=d||{},a.remoteName&&(c="/"+encodeURIComponent(a.remoteName)+c),a.baseUrl&&(c=""+a.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.hoodie.request(b,c,d)},h.isKnownObject=function(a,b){var c=""+b.type+"/"+b.id;return void 0!==a.knownObjects[c]?a.knownObjects[c]:void 0},h.markAsKnownObject=function(a,b){var c=""+b.type+"/"+b.id;return a.knownObjects[c]=1,a.knownObjects[c]},h.connect=function(a,b){return b&&(a.remoteName=b),a.connected=!0,a.hoodie.remote.trigger("connect"),a.hoodie.remote.bootstrap().then(function(){a.hoodie.remote.push()})},h.disconnect=function(a){a.connected=!1,a.hoodie.remote.trigger("disconnect"),a.pullRequest&&a.pullRequest.abort(),a.pushRequest&&a.pushRequest.abort()},h.isConnected=function(a){return a.connected},h.getSinceNr=function(a){return"function"==typeof a.since?a.since():a.since},h.bootstrap=function(a){return a.isBootstrapping=!0,a.hoodie.remote.trigger("bootstrap:start"),a.hoodie.remote.pull().done(g.handleBootstrapSuccess.bind(null,a)).fail(g.handleBootstrapError.bind(null,a))},h.pull=function(a){return a.pullRequest=a.hoodie.remote.request("GET",g.pullUrl(a)),a.hoodie.remote.isConnected()&&(c.clearTimeout(a.pullRequestTimeout),a.pullRequestTimeout=c.setTimeout(a.restartPullRequest,25e3)),a.pullRequest.done(g.handlePullSuccess.bind(null,a)).fail(g.handlePullError.bind(null,a))},h.push=function(a,b){var c,e=[];if($.isArray(b)||(b=g.defaultObjectsToPush(a)),0===b.length)return f([]);b=b.map(function(a){return d(!0,{},a)}),e=[];for(var h=0;h<b.length;h++)c=b[h],g.addRevisionTo(a,c),a.hoodie.remote.markAsKnownObject(c),c=g.parseForRemote(a,c),e.push(c),a.pushedObjectRevisions[c._rev]=1;return a.pushRequest=a.hoodie.remote.request("POST","/_bulk_docs",{data:{docs:e,new_edits:!1}}),a.pushRequest.done(function(){for(var c=0;c<b.length;c++)delete b[c]._revisions,a.hoodie.remote.trigger("push",b[c])}),a.pushRequest},h.sync=function(a,b){return a.hoodie.remote.push(b).then(a.hoodie.remote.pull)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":80,"./helpers":71,extend:40}],71:[function(a,b){(function(c){var d=a("extend"),e=a("../../../utils"),f=e.generateId,g=b.exports;g.VALID_SPECIAL_ATTRIBUTES=["_id","_rev","_deleted","_revisions","_attachments"],g.defaultObjectsToPush=function(a){return a.options&&a.options.defaultObjectsToPush?c.$.isArray(a.options.defaultObjectsToPush)?a.options.defaultObjectsToPush:a.options.defaultObjectsToPush():[]},g.setSinceNr=function(a,b){return"function"==typeof a.since?a.since(b):(a.since=b,a.since)},g.parseForRemote=function(a,b){var c,e;e=d({},b);for(c in e)if(e.hasOwnProperty(c)){if(-1!==g.VALID_SPECIAL_ATTRIBUTES.indexOf(c))continue;if(!/^_/.test(c))continue;delete e[c]}return e._id=""+e.type+"/"+e.id,a.prefix&&(e._id=""+a.prefix+e._id),delete e.id,e},g.parseFromRemote=function(a,b){var c,d;return c=b._id||b.id,delete b._id,a.prefix&&(c=c.replace(a.remotePrefixPattern,"")),d=c.match(/([^\/]+)\/(.*)/),b.type=d[1],b.id=d[2],b},g.parseAllFromRemote=function(a,b){return b.map(g.parseFromRemote.bind(null,a))},g.addRevisionTo=function(a,b){var c,d,e,f;return b._rev&&(f=b._rev.split(/-/),d=f[0],c=f[1]),d=parseInt(d,10)||0,e=g.generateNewRevisionId(a),b._$local&&(e+="-local"),b._rev=""+(d+1)+"-"+e,b._revisions={start:1,ids:[e]},c?(b._revisions.start+=d,b._revisions.ids.push(c)):void 0},g.generateNewRevisionId=function(){return f(9)},g.mapDocsFromFindAll=function(a,b){return b.rows.map(function(a){return a.doc})},g.pullUrl=function(a){var b=a.hoodie.remote.getSinceNr();return a.hoodie.remote.isConnected()&&!a.isBootstrapping?"/_changes?include_docs=true&since="+b+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+b},g.restartPullRequest=function(a){a.pullRequest&&a.pullRequest.abort()},g.handlePullSuccess=function(a,b){return g.setSinceNr(a,b.last_seq),g.handlePullResults(a,b.results),a.hoodie.remote.isConnected()?a.hoodie.remote.pull():void 0},g.handlePullError=function(a,b,d){if(a.hoodie.remote.isConnected())switch(b.status){case 401:return a.hoodie.remote.trigger("error:unauthenticated",d),a.hoodie.remote.disconnect();case 404:return c.setTimeout(a.hoodie.remote.pull,3e3);case 500:return a.hoodie.remote.trigger("error:server",d),c.setTimeout(a.hoodie.remote.pull,3e3),a.hoodie.checkConnection();default:return"abort"===b.statusText?a.hoodie.remote.pull():(c.setTimeout(a.hoodie.remote.pull,3e3),a.hoodie.checkConnection())}},g.handleBootstrapSuccess=function(a){a.isBootstrapping=!1,a.hoodie.remote.trigger("bootstrap:end")},g.handleBootstrapError=function(a,b){a.isBootstrapping=!1,a.hoodie.remote.trigger("bootstrap:error",b)},g.handlePullResults=function(a,b){for(var c,d,e,f=a.hoodie.remote,h=0;h<b.length;h++)if(c=b[h].doc,!(a.prefix&&0!==c._id.indexOf(a.prefix)||a.pushedObjectRevisions[c._rev])){if(e=g.parseFromRemote(a,c),e._deleted){if(!a.hoodie.remote.isKnownObject(e))continue;d="remove",f.isKnownObject(e)}else f.isKnownObject(e)?d="update":(d="add",f.markAsKnownObject(e));f.trigger(d,e),f.trigger(e.type+":"+d,e),f.trigger(e.type+":"+e.id+":"+d,e),f.trigger("change",d,e),f.trigger(e.type+":change",d,e),f.trigger(e.type+":"+e.id+":change",d,e),f.trigger(d+":"+e.type,e),f.trigger(d+":"+e.type+":"+e.id,e),f.trigger("change:"+e.type,d,e),f.trigger("change:"+e.type+":"+e.id,d,e)}a.pushedObjectRevisions={}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":80,extend:40}],72:[function(a,b){var c=a("../api"),d=a("./remotestore"),e=a("./api");b.exports=function(a,b){var f,g=!1,h="",i={get baseUrl(){return f},set baseUrl(a){f=a,j.baseUrl=a},get connected(){return g},set connected(a){g=a,j.connected=a},get prefix(){return h},set prefix(a){h=a,j.prefix=a},remoteName:null,remotePrefixPattern:new RegExp("^"),since:b.since||0,isBootstrapping:!1,pullRequest:void 0,pullRequestTimeout:void 0,pushRequest:void 0,pushedObjectRevisions:{},knownObjects:{},options:b,hoodie:a},j=c(a,{name:b.name,backend:{save:d.save.bind(null,i),find:d.find.bind(null,i),findAll:d.findAll.bind(null,i),remove:d.remove.bind(null,i),removeAll:d.removeAll.bind(null,i)}});if(void 0!==b.name&&(i.remoteName=b.name),void 0!==b.prefix&&(i.prefix=b.prefix,i.remotePrefixPattern=new RegExp("^"+i.prefix)),null!==b.baseUrl&&(i.baseUrl=b.baseUrl),Object.keys(e).forEach(function(a){"function"==typeof e[a]&&(j[a]=e[a].bind(null,i))}),b.knownObjects)for(var k=0;k<b.knownObjects.length;k++)j.markAsKnownObject({type:b.knownObjects[k].type,id:b.knownObjects[k].id});return j}},{"../api":68,"./api":70,"./remotestore":73}],73:[function(a,b,c){var d=a("../../../utils"),e=d.generateId,f=a("./helpers"),c=b.exports;c.find=function(a,b,c){var d;return d=b+"/"+c,a.prefix&&(d=a.prefix+d),d="/"+encodeURIComponent(d),a.hoodie.remote.request("GET",d).then(f.parseFromRemote.bind(null,a))},c.findAll=function(a,b){var c,d,e;switch(d="/_all_docs?include_docs=true",!0){case void 0!==b&&""!==a.prefix:e=a.prefix+b+"/";break;case void 0!==b:e=b+"/";break;case""!==a.prefix:e=a.prefix;break;default:e=""}return e&&(c=e.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),d=d+'&startkey="'+encodeURIComponent(e)+'"&endkey="'+encodeURIComponent(c)+'"'),a.hoodie.remote.request("GET",d).then(f.mapDocsFromFindAll.bind(null,a)).then(f.parseAllFromRemote.bind(null,a))},c.save=function(a,b){var c;return b.id||(b.id=e()),b=f.parseForRemote(a,b),c="/"+encodeURIComponent(b._id),a.hoodie.remote.request("PUT",c,{data:b})},c.remove=function(a,b,c){return a.hoodie.remote.update(b,c,{_deleted:!0})},c.removeAll=function(a,b){return a.hoodie.remote.updateAll(b,{_deleted:!0})}},{"../../../utils":80,"./helpers":71}],74:[function(a,b,c){var d=a("../../utils"),c=b.exports=function(a,b,e){var f={},g=e.id,h=e.name||"store",i=e.type;return d.events(a,f,[h,i,g].join(":").replace(/:$/,"")),f.decoratePromises=b.decoratePromises,f.validate=b.validate,g?(["save","find","update","remove"].forEach(function(a){f[a]=c[a].bind(null,b,i,g)}),f):(["save","add","find","findOrAdd","findAll","update","updateAll","remove","removeAll"].forEach(function(a){f[a]=c[a].bind(null,b,i)}),f)};c.save=function(a,b,c,d,e){return a.save(b,c,d,e)},c.add=function(a,b,c,d){return a.add(b,c,d)},c.find=function(a,b,c){return a.find(b,c)},c.findOrAdd=function(a,b,c,d){return a.findOrAdd(b,c,d)},c.findAll=function(a,b,c){return a.findAll(b,c)},c.update=function(a,b,c,d,e){return a.update(b,c,d,e)},c.updateAll=function(a,b,c,d){return a.updateAll(b,c,d)},c.remove=function(a,b,c,d){return a.remove(b,c,d)},c.removeAll=function(a,b,c){return a.removeAll(b,c)}},{"../../utils":80}],75:[function(a,b){b.exports={scoped:a("./scoped")}},{"./scoped":76}],76:[function(a,b,c){var d=a("../../utils"),c=b.exports=function(a,b,e){var f={},g=e.id,h=e.type;return d.events(a,f,["task",h,g].join(":").replace(/:$/,"")),g?(["abort","restart"].forEach(function(a){f[a]=c[a].bind(null,b,h,g)}),f):(["start","abort","restart","abortAll","restartAll"].forEach(function(a){f[a]=c[a].bind(null,b,h)}),f)};c.start=function(a,b,c){return a.start(b,c)},c.abort=function(a,b,c){return a.abort(b,c)},c.restart=function(a,b,c,d){return a.restart(b,c,d)},c.abortAll=function(a,b){return a.abortAll(b)},c.restartAll=function(a,b,c){return a.restartAll(b,c)}},{"../../utils":80}],77:[function(a,b,c){var d=a("../utils/local_storage_wrapper")(),e=a("extend"),c=b.exports=function(a){a=a||"_hoodie_config";var b={get:d.getObject.bind(null,a),set:d.setObject.bind(null,a),remove:d.removeItem.bind(null,a)},e=b.get()||{},f={config:e,store:b};return{set:c.set.bind(null,f),get:c.get.bind(null,f),clear:c.clear.bind(null,f),unset:c.unset.bind(null,f)}};c.set=function(a,b,c){a.config[b]=c,a.store.set(a.config)},c.get=function(a,b){return b?a.config[b]:e({},a.config)},c.clear=function(a){return a.config={},a.store.remove()},c.unset=function(a,b){delete a.config[b],a.store.set(a.config)}},{"../utils/local_storage_wrapper":81,extend:40}],78:[function(a,b,c){var d=a("jqevents"),e=a("extend"),c=b.exports=function(a,b,f){if(b&&f)return c.scopedEventEmitter.apply(null,arguments);
var g=d.create();return g.trigger=g.emit,g.one=g.once,g.bind=g.on,g.unbind=g.off,e(a,g),g};c.METHODS=["on","off","one","trigger","bind","unbind"];var f=/(^|\s)/g;c.scopedEventEmitter=function(a,b,d){var g={};return c.METHODS.forEach(function(b){g[b]=function(){var c=[].slice.call(arguments);c[0]=c[0].replace(f,"$1"+d+":"),a[b].apply(a,c)}}),e(b,g),g}},{extend:40,jqevents:42}],79:[function(a,b,c){var c=b.exports=function(a){return a=a||"0123456789abcdefghijklmnopqrstuvwxyz".split(""),c.generateId.bind(null,a)};c.generateId=function(a,b){var c="",d=a.length;void 0===b&&(b=7);for(var e=0;b>e;e++){var f=Math.random()*d,g=a[Math.floor(f)];c+=String(g).charAt(0)}return c}},{}],80:[function(a,b){b.exports={config:a("./config")(),events:a("./events"),generateId:a("./generate_id")(),localStorageWrapper:a("./local_storage_wrapper")(),promise:a("./promise")}},{"./config":77,"./events":78,"./generate_id":79,"./local_storage_wrapper":81,"./promise":83}],81:[function(a,b){(function(a){var c=b.exports=function(){return c.hasLocalStorage()?c.createWrapper(a.localStorage,!0):c.createWrapper(c.localStub,!1)};c.createWrapper=function(a,b){return{getItem:a.getItem.bind(a),setItem:a.setItem.bind(a),removeItem:a.removeItem.bind(a),key:a.key.bind(a),isPersistent:b,length:function(){return a.length},setObject:c.setObject.bind(null,a),getObject:c.getObject.bind(null,a)}};var d=function(){return null};c.localStub={getItem:d,setItem:d,removeItem:d,key:d,length:0},c.setObject=function(b,c,d){return"object"!=typeof d?b.setItem(c,d):b.setItem(c,a.JSON.stringify(d))},c.getObject=function(b,c){var d=b.getItem(c);if(!d)return null;try{return a.JSON.parse(d)}catch(e){return d}},c.hasLocalStorage=function(){try{if(!a.localStorage)return!1;if(a.localStorage.setItem("Storage-Test","1"),"1"!==a.localStorage.getItem("Storage-Test"))return!1;a.localStorage.removeItem("Storage-Test")}catch(b){return!1}return!0}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],82:[function(a,b,c){(function(d){var e=c.Promise=function(){var b;return b="function"==typeof d.Promise?d.Promise:a("bluebird"),b.prototype.done=function(a){return this.then(a),this},b.prototype.fail=function(a){return this.then(null,a),this},b.prototype.always=function(a){return this.then(a,a),this},b.prototype.progress=function(){return console.log("NOTE: promise.progress is currently not working"),this},b}();b.exports=function(){var a,b,c;return c=new e(function(){a=arguments[0],b=arguments[1]}),{resolve:a,reject:b,promise:c,notify:function(){console.log("NOTE: defer.notify is currently not working")}}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bluebird:3}],83:[function(a,b){b.exports={defer:a("./defer"),isPromise:a("./is_promise"),rejectWith:a("./reject_with"),reject:a("./reject"),resolveWith:a("./resolve_with"),resolve:a("./resolve")}},{"./defer":82,"./is_promise":84,"./reject":85,"./reject_with":86,"./resolve":87,"./resolve_with":88}],84:[function(a,b){b.exports=function(a){return a&&a.then?"function"==typeof a.then:!1}},{}],85:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.reject(),a.promise}},{"./defer":82}],86:[function(a,b){var c=a("./defer"),d=a("../../lib/error/error");b.exports=function(a){var b=new d(a),e=c();return e.reject(b),e.promise}},{"../../lib/error/error":60,"./defer":82}],87:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.resolve(),a.promise}},{"./defer":82}],88:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.resolve.apply(a,arguments),a.promise}},{"./defer":82}]},{},[43])(43)});
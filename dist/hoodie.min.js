// Hoodie.js - 1.0.0
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Hoodie=a():"undefined"!=typeof global?global.Hoodie=a():"undefined"!=typeof self&&(self.Hoodie=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],2:[function(a,b){function c(a){var b=this;if(!(b instanceof c))throw new Error("usage: new Hoodie(url);");b.baseUrl=a?a.replace(/\/+$/,""):"",b.extend=function(a){a(b,o,p)},b.extend(n),b.extend(h),b.extend(l),b.extend(j),b.extend(k),b.extend(f),b.extend(g),b.extend(i),b.extend(m),b.on("account:cleanup",p.config.clear),b.id.init(),b.account.username=p.config.get("_account.username"),b.account.bearerToken=p.config.get("_account.bearerToken"),b.remote.init(),b.account.checkPasswordReset(),b.store.bootstrapDirtyObjects(),b.account.subscribeToOutsideEvents(),b.id.subscribeToOutsideEvents(),b.store.subscribeToOutsideEvents(),b.remote.subscribeToOutsideEvents(),b.task.subscribeToOutsideEvents(),b.account.authenticate().then(function(){b.remote.connect()}),e.addEventListener("online",b.checkConnection,!1),e.addEventListener("offline",b.checkConnection,!1),b.checkConnection(),d(b)}function d(a){for(var b=0;b<q.length;b++)q[b](a,o,p)}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./hoodie/account"),g=a("./hoodie/remote"),h=a("./hoodie/connection"),i=a("./hoodie/id"),j=a("./hoodie/store"),k=a("./hoodie/task"),l=a("./hoodie/open"),m=a("./hoodie/request"),n=a("./lib/events"),o=a("./lib"),p=a("./utils"),q=[];c.extend=function(a){q.push(a)},b.exports=c},{"./hoodie/account":3,"./hoodie/connection":4,"./hoodie/id":5,"./hoodie/open":6,"./hoodie/remote":7,"./hoodie/request":8,"./hoodie/store":9,"./hoodie/task":10,"./lib":16,"./lib/events":15,"./utils":26}],3:[function(a,b){function c(a){function b(a){return h.set(_,a)}function c(){return h.get(_)}function n(){return h.unset(_)}function o(){var b=a.id(),d=c();return X.signIn(b,d).done(function(){X.trigger("signin:anonymous",b)})}function p(){a.on("remote:error:unauthenticated",q)}function q(){return W=void 0,X.authenticate()}function r(a){return X.username!==a?(X.username=a,h.set("_account.username",a)):void 0}function s(a){return X.bearerToken!==a?(X.bearerToken=a,h.set("_account.bearerToken",a)):void 0}function t(a){return a.userCtx.name?(W=!0,m(X.username)):X.hasAnonymousAccount()?o():(W=!1,X.trigger("error:unauthenticated"),j())}function u(a,b){return function(c){return Y._rev=c.rev,w(a,b)}}function v(a){return function(b){return"HoodieConflictError"===b.name&&(b.message="Username "+a+" already exists"),l(b)}}function w(a,b,c,e){return e||(e=i()),d.setTimeout(function(){var d=T(a,b,c);d.done(e.resolve),d.fail(function(d){"HoodieAccountUnconfirmedError"===d.name?w(a,b,c,e):e.reject.apply(e,arguments)})},300),e.promise()}function x(a){return a=a||{},function(b){var c,d,e;return c=b.name.replace(/^user(_anonymous)?\//,""),d=b.roles[0],e=b.bearerToken,-1!==b.roles.indexOf("error")?X.fetch(c).then(function(){return l(Y.$error)}):-1===b.roles.indexOf("confirmed")?l({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(W=!0,s(e),X.fetch(),m(c,d,e,a))}}function y(a){var b;return a.$error?(b=a.$error,b.object=a,delete b.object.$error):b={name:"HoodiePendingError",message:"Password reset is still pending"},l(b)}function z(a){return function(b){return"HoodieUnauthorizedError"===b.name?(h.unset("_account.resetPasswordId"),X.trigger("passwordreset",a),k()):l(b)}}function A(){var a=i();return X.one("passwordreset",a.resolve),X.on("error:passwordreset",B),X.on("error:passwordreset",a.reject),a.always(function(){X.unbind("passwordreset",a.resolve),X.unbind("error:passwordreset",B),X.unbind("error:passwordreset",a.reject)}),a.promise()}function B(a){var b=a.object,c=b.name,d=c.substr(15),e="/_users/"+encodeURIComponent($+":"+c),f=btoa(c+":"+d);b._deleted=!0;var g={headers:{Authorization:"Basic "+f},contentType:"application/json",data:JSON.stringify(b)};X.request("PUT",e,g),h.unset("_account.resetPasswordId")}function C(b,c,d){var e=X.hasAnonymousAccount()?a.id():X.username;return T(e,b).then(function(){return X.fetch().then(M(b,c,d))})}function D(a,b){var d=c();return C(d,a,b).done(function(){X.trigger("signup",a),n()})}function E(){return H(),Y._deleted=!0,P("updateUsersDoc",function(){X.request("PUT",L(),{data:JSON.stringify(Y),contentType:"application/json"})})}function F(a){return"HoodieNotFoundError"===a.name?k():l(a)}function G(){return X.trigger("cleanup"),W=void 0,r(void 0),s(void 0),k()}function H(){return a.remote.disconnect()}function I(){var a=X.username;return G().then(function(){return X.trigger("signout",a)})}function J(b){var c;return c=b===a.id()?"user_anonymous":"user",""+c+"/"+b}function K(b){var c=X.hasAnonymousAccount()?a.id():X.username;return b=b||c,""+$+":"+J(b)}function L(a){return"/_users/"+encodeURIComponent(K(a))}function M(a,b,c){return function(){var d=f({},Y);b&&(d.$newUsername=b),d.updatedAt=V(),d.signedUpAt=d.signedUpAt||V(),void 0!==c&&(delete d.salt,delete d.password_sha,d.password=c);var e={data:JSON.stringify(d),contentType:"application/json"};return P("updateUsersDoc",function(){var d=i();return X.request("PUT",L(),e).done(d.notify).then(N(b,c||a)).done(d.resolve),d.promise()})}}function N(b,c){var d=X.hasAnonymousAccount()?a.id():X.username;return function(){return H(),b?O(d,c).then(function(){return X.signOut({silent:!0,moveData:!0}).then(function(){return X.signIn(b,c,{moveData:!0,silent:!0})})}):X.signIn(d,c,{silent:!0})}}function O(a,b,c){c||(c=i());var e={data:{name:J(a),password:b}};return P("signIn",function(){return X.request("POST","/_session",e)}).done(function(){d.setTimeout(O,300,a,b,c)}).fail(function(a){return 401===a.status?c.resolve():void c.reject(a)}),c.promise()}function P(a,b){return void 0!==Z[a]&&"function"==typeof Z[a].abort&&Z[a].abort(),Z[a]=b(),Z[a]}function Q(a,b){return void 0!==Z[a]&&"function"==typeof Z[a].state&&"pending"===Z[a].state()?Z[a]:(Z[a]=b(),Z[a])}function R(b){return a.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.remote.push():k()}function S(){return Q("signOut",function(){return X.request("DELETE","/_session")})}function T(a,b,c){var d={data:{name:J(a),password:b}};return P("signIn",function(){var a=X.request("POST","/_session",d);return a.then(x(c))})}function U(b,c){var d,e=i();return b=b.toLowerCase(),d={data:JSON.stringify({_id:K(b),name:J(b),type:"user",roles:[],password:c,hoodieId:a.id(),database:X.db(),updatedAt:V(),createdAt:V(),signedUpAt:b!==a.id()?V():void 0}),contentType:"application/json"},X.request("PUT",L(b),d).done(e.notify).then(u(b,c),v(b)).then(e.resolve,e.reject),e.promise()}function V(){return new Date}var W,X={},Y={},Z={},$="org.couchdb.user";e(a,{context:X,namespace:"account"}),X.authenticate=function(){var a;return W===!1?j():W===!0?m(X.username):Z.signOut&&"pending"===Z.signOut.state()?Z.signOut.then(j):Z.signIn&&"pending"===Z.signIn.state()?Z.signIn:X.hasAccount()?(a=function(){return X.request("GET","/_session").then(t)},Q("authenticate",a)):S().then(function(){return W=!1,j()})},X.hasValidSession=function(){return X.hasAccount()?W===!0:!1},X.hasInvalidSession=function(){return X.hasAccount()?W===!1:!1},X.signUp=function(a,b){return void 0===b&&(b=""),a?X.hasAnonymousAccount()?D(a,b):X.hasAccount()?l("Must sign out first."):U(a,b).done(function(b,c,d){r(a),s(d),X.trigger("signup",a)}):l("Username must be set.")},X.anonymousSignUp=function(){var c,d;return c=g(10),d=a.id(),U(d,c).progress(function(){b(c)}).done(function(){X.trigger("signup:anonymous")})},X.hasAccount=function(){var a=!!X.username;return a||X.hasAnonymousAccount()},X.hasAnonymousAccount=function(){return!!c()};var _="_account.anonymousPassword";X.signIn=function(a,b,c){var d,e,f=a===X.username;return a||(a=""),b||(b=""),a=a.toLowerCase(),c=c||{},d=c.silent,e=!X.hasAccount()||f||c.moveData?T(a,b,c):R(c).then(function(){return T(a,b,c)}),f||e.done(H),e.done(function(a,b,e){c.moveData&&X.trigger("movedata"),f||c.moveData||G(),s(e),f?d||X.trigger("reauthenticated",a):r(a),d||X.trigger("signin",a,b,c)})},X.signOut=function(a){var b;return a=a||{},b=a.silent?G:I,X.hasAccount()?a.moveData?S():R(a).then(H).then(S).then(b):b()},X.request=function(b,c,d){return d=d||{},a.request.apply(a,arguments)},X.db=function(){return"user/"+a.id()},X.fetch=function(b){var c=X.hasAnonymousAccount()?a.id():X.username;return void 0===b&&(b=c),b?Q("fetch",function(){return X.request("GET",L(b)).done(function(a){return Y=a})}):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},X.changePassword=function(a,b){return X.username?(H(),X.fetch().then(M(a,null,b)).done(function(){X.trigger("changepassword")})):l({name:"HoodieUnauthorizedError",message:"Not signed in"})},X.resetPassword=function(a){var b,c,d,e;return(e=h.get("_account.resetPasswordId"))?X.checkPasswordReset():(e=""+a+"/"+g(),h.set("_account.resetPasswordId",e),c=""+$+":$passwordReset/"+e,b={_id:c,name:"$passwordReset/"+e,type:"user",roles:[],password:e,createdAt:V(),updatedAt:V()},d={data:JSON.stringify(b),contentType:"application/json"},P("resetPassword",function(){return X.request("PUT","/_users/"+encodeURIComponent(c),d).done(X.checkPasswordReset).then(A).done(function(){X.trigger("resetpassword")})}))},X.checkPasswordReset=function(){var a,b,c,e,f,g;return(c=h.get("_account.resetPasswordId"))?(f=c.split("/")[0],g="$passwordReset/"+c,e="/_users/"+encodeURIComponent($+":"+g),a=btoa(g+":"+c),b={headers:{Authorization:"Basic "+a}},Q("passwordResetStatus",function(){return X.request("GET",e,b).then(y,z(f)).fail(function(a){return"HoodiePendingError"===a.name?void d.setTimeout(X.checkPasswordReset,1e3):X.trigger("error:passwordreset",a,f)})})):l("No pending password reset.")},X.changeUsername=function(b,c){var d=X.hasAnonymousAccount()?a.id():X.username;return c!==d?(c=c||"",C(b,c.toLowerCase()).done(function(){r(c),X.trigger("changeusername",c)})):l({name:"HoodieConflictError",message:"Usernames identical"})},X.destroy=function(){return X.hasAccount()?X.fetch().then(E,F).then(I):I()},X.subscribeToOutsideEvents=function(){p(),delete X.subscribeToOutsideEvents},a.account=X}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/events"),f=a("extend"),g=a("../utils/generate_id"),h=a("../utils/config"),i=a("../utils/promise/defer"),j=a("../utils/promise/reject"),k=a("../utils/promise/resolve"),l=a("../utils/promise/reject_with"),m=a("../utils/promise/resolve_with");b.exports=c},{"../lib/events":15,"../utils/config":23,"../utils/generate_id":24,"../utils/promise/defer":28,"../utils/promise/reject":31,"../utils/promise/reject_with":32,"../utils/promise/resolve":33,"../utils/promise/resolve_with":34,extend:1}],4:[function(a,b){function c(a){function b(){return h=3e4,j=d.setTimeout(a.checkConnection,h),a.isConnected()||(a.trigger("reconnected"),g=!0),f()}function c(){return h=3e3,j=d.setTimeout(a.checkConnection,h),a.isConnected()&&(a.trigger("disconnected"),g=!1),e()}var g=!0,h=3e4,i=null,j=null;a.checkConnection=function(){var e=i,f="/?hoodieId="+a.id();return e&&"pending"===e.state()?e:(d.clearTimeout(j),i=a.request("GET",f).then(b,c))},a.isConnected=function(){return g}}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../utils/promise/reject"),f=a("../utils/promise/resolve");b.exports=c},{"../utils/promise/reject":31,"../utils/promise/resolve":33}],5:[function(a,b){function c(a){function b(){return i||c(d()),i}function c(a){i=a,e.set("_hoodieId",a)}function f(){i=void 0,e.unset("_hoodieId")}function g(){i=e.get("_hoodieId"),i||(i=e.get("_account.ownerHash"))}function h(){a.on("account:cleanup",f),a.on("account:signin",function(a,b){c(b)}),a.on("account:signin:anonymous",c)}var i;b.init=function(){g(),delete b.init},b.subscribeToOutsideEvents=function(){h(),delete b.subscribeToOutsideEvents},a.id=b}var d=a("../utils/generate_id"),e=a("../utils/config");b.exports=c},{"../utils/config":23,"../utils/generate_id":24}],6:[function(a,b){function c(a){function b(b,c){return c=c||{},e(c,{name:b}),d(a,c)}a.open=b}var d=a("../lib/store/remote"),e=a("extend");b.exports=c},{"../lib/store/remote":19,extend:1}],7:[function(a,b){function c(a){function b(a){return a?e.set("_remote.since",a):e.get("_remote.since")||0}function c(){a.on("remote:connect",function(){a.on("store:idle",d.push)}),a.on("remote:disconnect",function(){a.unbind("store:idle",d.push)}),a.on("disconnected",d.disconnect),a.on("reconnected",d.connect),a.on("account:signup",d.connect),a.on("account:signup:anonymous",d.connect),a.on("account:signin",d.connect),a.on("account:signin:anonymous",d.connect),a.on("account:changeusername",d.connect),a.on("account:reauthenticated",d.connect),a.on("account:signout",d.disconnect)}var d=a.open(a.account.db(),{connected:!0,prefix:"",since:b,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})}),g=d.connect;d.connect=function(){return a.account.hasAccount()?g(a.account.db()):f("User has no database to connect to")},d.trigger=function(){var b;b=arguments[0];var c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return a.trigger.apply(a,["remote:"+b].concat(Array.prototype.slice.call(c)))},d.on=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},d.unbind=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},d.subscribeToOutsideEvents=function(){c(),delete d.subscribeToOutsideEvents},a.remote=d}function d(a){var b=function(){c(a)};a.remote={init:b}}var e=a("../utils/config"),f=a("../utils/promise/reject_with");b.exports=d},{"../utils/config":23,"../utils/promise/reject_with":32}],8:[function(a,b){function c(a){function b(b,d,f){var g,j,k;return f=f||{},g={type:b,dataType:"json"},/^http/.test(d)||(d=(a.baseUrl||"")+i+d),/^http/.test(d)&&(g.xhrFields={withCredentials:!0},g.crossDomain=!0),g.url=d,a.account.bearerToken&&(g.headers={Authorization:"Bearer "+a.account.bearerToken}),j=h(e(g,f)),k=j.then(null,c),k.abort=j.abort,k}function c(b){var c;try{c=g(b)}catch(d){c=b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return f(c).promise()}function g(a){var b=JSON.parse(a.responseText);return b.name=j[a.status],b.name||(b.name=d(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}var h=$.ajax,i="/_api",j={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"};a.request=b}var d=a("../utils/hoodiefy_request_error_name"),e=a("extend"),f=a("../utils/promise/reject_with");b.exports=c},{"../utils/hoodiefy_request_error_name":25,"../utils/promise/reject_with":32,extend:1}],9:[function(a,b){function c(a){function b(a){if(f.isInvalid(a.type))return new f({type:a.type});if(a.id)return g.isInvalid(a.id)?new g({id:a.id}):void 0}function c(a,b,c,d){var e,f;if(void 0===c&&(c=!1),d=d||{},e=""+a+"/"+b,c){if(i(c,{type:a,id:b}),f=i({},c),delete f.type,delete f.id,m.setObject(e,f),d.remote)return q(a,b),H[e]=i(!0,{},c),H[e]}else{if(H[e]===!1)return!1;if(H[e])return i(!0,{},H[e]);if(e=""+a+"/"+b,c=m.getObject(e),!c)return q(a,b),H[e]=!1,!1;c.type=a,c.id=b}return y(c)?(p(a,b,c,d),H[e]=!1,!1):(H[e]=i(!0,{},c),x(c)?p(a,b,H[e],d):q(a,b),i(!0,{},c))}function n(){var a,b,d,e,f,g,h;if(b=m.getItem("_dirty"))for(b=b.split(","),f=0,g=b.length;g>f;f++)h=b[f].split("/"),e=h[0],a=h[1],d=c(e,a)}function o(){a.on("account:signup",r),a.on("account:movedata",F),a.on("account:cleanup",L.clear),a.on("remote:bootstrap:start",B),a.on("remote:bootstrap:end",C),a.on("remote:bootstrap:error",D),a.on("remote:change",s),a.on("remote:push",t)}function p(a,b,c,d){var e;d=d||{},e=""+a+"/"+b,I[e]=c,u(),d.silent||A()}function q(a,b){var c;return a&&b?(c=""+a+"/"+b,delete I[c]):I={},u(),d.clearTimeout(N)}function r(){return L.findAll().pipe(function(a){var b,c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=""+c.type+"/"+c.id,I[b]=c;u(),A()})}function s(a,b){"remove"===a?L.remove(b.type,b.id,{remote:!0,update:b}):L.save(b.type,b.id,b,{remote:!0})}function t(a){z("sync",a),a._deleted?L.remove(a.type,a.id,{remote:!0,silent:!0}):L.save(a.type,a.id,a,{remote:!0,silent:!0})}function u(){try{if($.isEmptyObject(I))m.removeItem("_dirty");else{var a=Object.keys(I);m.setItem("_dirty",a.join(","))}}catch(b){}}function v(){return JSON.stringify(new Date).replace(/['"]/g,"")}function w(a){return O.test(a)}function x(a){return a.updatedAt?a._syncedAt?a._syncedAt<a.updatedAt:!0:!1}function y(a){return a._deleted===!0}function z(a,b,c){L.trigger(a,i(!0,{},b),c),L.trigger(b.type+":"+a,i(!0,{},b),c),L.trigger(a+":"+b.type,i(!0,{},b),c),"new"!==a&&(L.trigger(b.type+":"+b.id+":"+a,i(!0,{},b),c),L.trigger(a+":"+b.type+":"+b.id,i(!0,{},b),c)),"sync"!==a&&(L.trigger("change",a,i(!0,{},b),c),L.trigger(b.type+":change",a,i(!0,{},b),c),L.trigger("change:"+b.type,a,i(!0,{},b),c),"new"!==a&&(L.trigger(b.type+":"+b.id+":change",a,i(!0,{},b),c),L.trigger("change:"+b.type+":"+b.id,a,i(!0,{},b),c)))}function A(){L.trigger("dirty"),d.clearTimeout(N),N=d.setTimeout(function(){L.trigger("idle",L.changedObjects())},K)}function B(){M=!0,L.trigger("bootstrap:start")}function C(){var a,b,c,d;for(M=!1;J.length>0;)a=J.shift(),b=a[0],c=a[1],d=a[2],G[b].apply(G,c).then(d.resolve,d.reject);L.trigger("bootstrap:end")}function D(a){var b,c;for(M=!1;J.length>0;)b=J.shift(),c=b[2],c.reject(a);L.trigger("bootstrap:error",a)}function E(a,b){var c=j();return J.push([a,b,c]),c.promise()}function F(){var b,d=[];L.findAll().done(function(e){d=e,d.length&&(b=a.id(),a.one("account:signin",function(a,e){d.forEach(function(a){a.createdBy===b&&(a.createdBy=e),a=c(a.type,a.id,a),p(a.type,a.id,a,{silent:!0})}),A()}))})}var G={},H={},I={},J=[],K=2e3;G.save=function(b,d){var e,f,g,i,k,l;if(d=d||{},L.isBootstrapping()&&!d.remote)return E("save",arguments);if(b.id?(e=c(b.type,b.id),k="object"!=typeof e):(k=!0,b.id=h()),k?b.createdBy=b.createdBy||a.id():e.createdBy&&(b.createdBy=e.createdBy),!k)for(l in e)if(!b.hasOwnProperty(l))switch(l.charAt(0)){case"_":d.remote&&(b[l]=e[l]);break;case"$":d.remote||(b[l]=e[l])}d.remote?b._syncedAt=v():d.silent||(b.updatedAt=v(),b.createdAt=b.createdAt||b.updatedAt),d.local?b._$local=!0:delete b._$local,f=j();try{b=c(b.type,b.id,b,d),f.resolve(b,k).promise(),i=k?"add":"update",d.silent||z(i,b,d)}catch(m){g=m,f.reject(g.toString())}return f.promise()},G.find=function(a,b){var d,e;if(L.isBootstrapping())return E("find",arguments);try{return e=c(a,b),e?l(e):k({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found'})}catch(f){return d=f,k(d)}},G.findAll=function(a){var b,d,e,f,g,h,i,k,l;if(null==a&&(a=function(){return!0}),L.isBootstrapping())return E("findAll",arguments);h=L.index(),"string"==typeof a&&(l=a,a=function(a){return a.type===l}),d=j();try{k=function(){var d,e,j,k;for(k=[],d=0,e=h.length;e>d;d++)g=h[d],w(g)&&(j=g.split("/"),b=j[0],f=j[1],i=c(b,f),i&&a(i)&&k.push(i));return k}.call(this),k.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),d.resolve(k).promise()}catch(m){e=m,d.reject(e).promise()}return d.promise()},G.remove=function(a,b,d){var e,f,g;return d=d||{},L.isBootstrapping()&&!d.remote?E("remove",arguments):(e=a+"/"+b,f=c(a,b),d.update&&(f=d.update,delete d.update),d.remote&&(m.removeItem(e),g=H[e]&&y(H[e]),H[e]=!1,q(a,b),f)?(g||z("remove",f,d),l(f)):f?(f._syncedAt?(f._deleted=!0,c(a,b,f)):(e=a+"/"+b,m.removeItem(e),H[e]=!1,q(a,b)),z("remove",f,d),l(f)):k({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}"" could not be found'}))},G.removeAll=function(a,b){return L.findAll(a).then(function(a){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(L.remove(c.type,c.id,b));return f})};var L=e(a,{validate:b,backend:{save:G.save,find:G.find,findAll:G.findAll,remove:G.remove,removeAll:G.removeAll}});L.index=function(){var a,b,c,d,e;for(c=[],a=d=0,e=m.length();e>=0?e>d:d>e;a=e>=0?++d:--d)b=m.key(a),w(b)&&c.push(b);return c},L.changedObjects=function(){var a,b,c,d,e,f,g;e=I,g=[];for(b in e)e.hasOwnProperty(b)&&(c=e[b],f=b.split("/"),d=f[0],a=f[1],c.type=d,c.id=a,g.push(c));return g},L.hasLocalChanges=function(a,b){if(!a)return!$.isEmptyObject(I);var d=[a,b].join("/");return I[d]?!0:x(c(a,b))},L.clear=function(){var a,b,c,d;a=j();try{c=L.index(),d=function(){var a,d,e;for(e=[],a=0,d=c.length;d>a;a++)b=c[a],w(b)&&e.push(m.removeItem(b));return e}.call(this),H={},q(),a.resolve(),L.trigger("clear")}catch(e){a.reject(e)}return a.promise()};var M=!1;L.isBootstrapping=function(){return M},L.isPersistent=function(){return m.isPersistent},L.subscribeToOutsideEvents=function(){o(),delete L.subscribeToOutsideEvents};var N,O=new RegExp(/^[a-z$][a-z0-9-]+\/[a-z0-9]+$/);a.store=L,L.bootstrapDirtyObjects=function(){n(),delete L.bootstrapDirtyObjects}}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/store/api"),f=a("../lib/error/object_type"),g=a("../lib/error/object_id"),h=a("../utils/generate_id"),i=a("extend"),j=a("../utils/promise/defer"),k=a("../utils/promise/reject_with"),l=a("../utils/promise/resolve_with"),m=a("../utils/local_storage_wrapper");b.exports=c},{"../lib/error/object_id":13,"../lib/error/object_type":14,"../lib/store/api":17,"../utils/generate_id":24,"../utils/local_storage_wrapper":27,"../utils/promise/defer":28,"../utils/promise/reject_with":32,"../utils/promise/resolve_with":34,extend:1}],10:[function(a,b){function c(a){function b(){a.on("store:change",j)}function c(b){var c=h(),d=a.store(b.type,b.id);return d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c.resolve(a):void c.reject(new f({message:"Task has been aborted",task:a}))}),d.on("update",function(b){var d=b.$error;b.$error&&(b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",c.reject(new f(d)),a.store.remove("$"+b.type,b.id))}),c.promise()}function i(b){var c,d=b.type,e=b.id,f=a.store.remove(d,e);return b._rev?(c=h(),a.one("store:sync:"+d+":"+e,c.resolve),f.fail(c.reject),c.promise()):f}function j(a,b,c){"$"===b.type[0]&&(b.type=b.type.substr(1),n(a,b,c))}function k(b){var c,d="$";return b&&(d+=b),c=function(a){return 0===a.type.indexOf(d)},a.store.findAll(c)}function l(a){return a.map(function(a){return p.abort(a.type.substr(1),a.id)})}function m(a,b){return a.map(function(a){return p.restart(a.type.substr(1),a.id,b)})}function n(a,b,c){var d;return"add"===a&&(a="start"),"remove"===a&&b.abortedAt&&(a="abort"),"remove"===a&&b.$processedAt&&!b.$error&&(a="success"),"update"===a&&b.$error?(a="error",d=b.$error,delete b.$error,p.trigger("error",d,b,c),p.trigger(b.type+":error",d,b,c),p.trigger(b.type+":"+b.id+":error",d,b,c),c=g({},c,{error:d}),p.trigger("change","error",b,c),p.trigger(b.type+":change","error",b,c),void p.trigger(b.type+":"+b.id+":change","error",b,c)):void(("start"===a||"abort"===a||"success"===a)&&(p.trigger(a,b,c),p.trigger(b.type+":"+a,b,c),"start"!==a&&p.trigger(b.type+":"+b.id+":"+a,b,c),p.trigger("change",a,b,c),p.trigger(b.type+":change",a,b,c),"start"!==a&&p.trigger(b.type+":"+b.id+":change",a,b,c)))}function o(){return JSON.stringify(new Date).replace(/['"]/g,"")}var p=function q(b,c){return e(a,q,{type:b,id:c})};d(a,{context:p,namespace:"task"}),p.start=function(b,d){return a.account.hasAccount()?a.store.add("$"+b,d).then(c):a.account.anonymousSignUp().then(function(){return p.start(b,d)})},p.abort=function(b,c){return a.store.update("$"+b,c,{abortedAt:o()}).then(i)},p.restart=function(a,b,c){var d=function(a){return g(a,c),delete a.$error,delete a.$processedAt,delete a.abortedAt,p.start(a.type,a)};return p.abort(a,b).then(d)},p.abortAll=function(a){return k(a).then(l)},p.restartAll=function(a,b){return"object"==typeof a&&(b=a),k(a).then(function(a){m(a,b)})},p.subscribeToOutsideEvents=function(){b(),delete p.subscribeToOutsideEvents},a.task=p}var d=a("../lib/events"),e=a("../lib/task/scoped"),f=a("../lib/error/error"),g=a("extend"),h=a("../utils/promise/defer");b.exports=c},{"../lib/error/error":11,"../lib/events":15,"../lib/task/scoped":22,"../utils/promise/defer":28,extend:1}],11:[function(a,b){function c(a){"string"==typeof a&&(a={message:a}),a.message||(a.message="Something went wrong"),a.name||(a.name="HoodieError"),a.message=a.message.replace(d,function(b){var c=b.match(e)[0];return a[c]}),f(this,a)}var d=/\{\{\s*\w+\s*\}\}/g,e=/\w+/,f=a("extend");c.prototype=new Error,c.prototype.constructor=c,b.exports=c},{extend:1}],12:[function(a,b){b.exports={error:a("./error"),objectId:a("./object_id"),objectType:a("./object_type")}},{"./error":11,"./object_id":13,"./object_type":14}],13:[function(a,b){function c(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z0-9\-]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":11}],14:[function(a,b){function c(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z$][a-z0-9-]+$/;c.isInvalid=function(a,b){return!(b||e).test(a||"")},c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":11}],15:[function(a,b){function c(a,b){function c(b,c){var d,e,f,g;for(d=b.split(" "),f=0,g=d.length;g>f;f++)e=h+d[f],a.eventsCallbacks[e]=a.eventsCallbacks[e]||[],a.eventsCallbacks[e].push(c)}function d(b,c){b=h+b;var d=function(){a.unbind(b,d),c.apply(null,arguments)};a.bind(b,d)}function e(){var b,c,d,e,f,g;if(b=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],d=b.shift(),d=h+d,e=a.eventsCallbacks[d]){for(f=0,g=e.length;g>f;f++)c=e[f],c.apply(null,b);return!0}}function f(b,c){var d,e,f,g,i,j;if(!b)return h||(a.eventsCallbacks={}),j=Object.keys(a.eventsCallbacks),j=j.filter(function(a){return 0===a.indexOf(h)}),void j.forEach(function(b){delete a.eventsCallbacks[b]});if(b=h+b,f=a.eventsCallbacks[b]){if(!c)return void delete a.eventsCallbacks[b];for(e=g=0,i=f.length;i>g;e=++g)if(d=f[e],d===c){f=f.slice(),f.splice(e,1),a.eventsCallbacks[b]=f;break}}}var g=a,h="";b=b||{},a.eventsCallbacks||(a.eventsCallbacks={}),b.context&&(g=b.context,h=b.namespace+":"),g.bind=c,g.on=c,g.one=d,g.trigger=e,g.unbind=f,g.off=f}b.exports=c},{}],16:[function(a,b){b.exports={error:a("./error"),events:a("./events"),store:a("./store"),task:a("./task")}},{"./error":12,"./events":15,"./store":18,"./task":21}],17:[function(a,b){function c(a,b){function c(a){return i(a,o)}var n={},o={hoodie:a},p=b.name||"store",q=function u(c,e){var f=i(!0,{type:c,id:e},b);return d(a,u,f)};if(e(a,{context:q,namespace:p}),q.validate=b.validate,b.validate||(q.validate=function(a){if(!a)return new f({name:"InvalidObjectError",message:"No object passed."});if(g.isInvalid(a.type,s))return new g({type:a.type,rules:t});if(a.id)return h.isInvalid(a.id,s)?new h({id:a.id,rules:t}):void 0}),q.save=function(a,b,d,e){e=e?i(!0,{},e):{};var f=i(!0,{},d,{type:a,id:b}),g=q.validate(f,e||{});return g?k(g):c(n.save(f,e||{}))},q.add=function(a,b,c){return void 0===b&&(b={}),c=c||{},q.save(a,b.id,b,c)},q.find=function(a,b){return c(n.find(a,b))},q.findOrAdd=function(a,b,d){function e(){var c;return c=i(!0,{id:b},d),q.add(a,c)}null===d&&(d={});var f=q.find(a,b).then(null,e);return c(f)},q.findAll=function(a,b){return c(n.findAll(a,b))},q.update=function(a,b,d,e){function f(c){var f,g,h;return g=i(!0,{},c),"function"==typeof d&&(d=d(g)),d?(f=function(){var a=[];for(var b in d)if(d.hasOwnProperty(b)){if(h=d[b],c[b]===h)continue;g[b]=h,a.push(b)}return a}(),f.length||e?q.save(a,b,g,e):l(g)):l(c)}var g=q.find(a,b).then(f);return c(g)},q.updateOrAdd=function(a,b,d,e){function f(){var c=i(!0,{},d,{id:b});return q.add(a,c,e)}var g=q.update(a,b,d,e).then(null,f);return c(g)},q.updateAll=function(a,b,d){var e;switch(d=d||{},!0){case"string"==typeof a:e=q.findAll(a);break;case m(a):e=a;break;case $.isArray(a):e=j().resolve(a).promise();break;default:e=q.findAll()}return e=e.then(function(a){var c,e;return $.isArray(a)||(a=[a]),e=function(){var e,f,g;for(g=[],e=0,f=a.length;f>e;e++)c=a[e],g.push(q.update(c.type,c.id,b,d));return g}(),$.when.apply(null,e).then(function(){return Array.prototype.slice.call(arguments)})}),c(e)},q.remove=function(a,b,d){return c(n.remove(a,b,d||{}))},q.removeAll=function(a,b){return c(n.removeAll(a,b||{}))},q.decoratePromises=function(a){return i(o,a)},!b.backend)throw new Error("options.backend must be passed");var r="save find findAll remove removeAll".split(" ");r.forEach(function(a){if(!b.backend[a])throw new Error("options.backend."+a+" must be passed.");n[a]=b.backend[a]});var s=/^[^\/]+$/,t="/ not allowed";return q}var d=a("./scoped"),e=a("../events"),f=a("../error/error"),g=a("../error/object_type"),h=a("../error/object_id"),i=a("extend"),j=a("../../utils/promise/defer"),k=a("../../utils/promise/reject_with"),l=a("../../utils/promise/resolve_with"),m=a("../../utils/promise/is_promise");b.exports=c},{"../../utils/promise/defer":28,"../../utils/promise/is_promise":30,"../../utils/promise/reject_with":32,"../../utils/promise/resolve_with":34,"../error/error":11,"../error/object_id":13,"../error/object_type":14,"../events":15,"./scoped":20,extend:1}],18:[function(a,b){b.exports={api:a("./api"),remote:a("./remote"),scoped:a("./scoped")}},{"./api":17,"./remote":19,"./scoped":20}],19:[function(a,b){function c(a,b){function c(a){return"function"==typeof z?z(a):z=a}function i(a){var b,c;c=f({},a);for(b in c)if(c.hasOwnProperty(b)){if(-1!==G.indexOf(b))continue;if(!/^_/.test(b))continue;delete c[b]}return c._id=""+c.type+"/"+c.id,w.prefix&&(c._id=""+w.prefix+c._id),delete c.id,c}function j(a){var b,c;return b=a._id||a.id,delete a._id,w.prefix&&(b=b.replace(y,"")),c=b.match(/([^\/]+)\/(.*)/),a.type=c[1],a.id=c[2],a}function k(a){return a.map(j)}function l(a){var b,c,d,e;try{e=a._rev.split(/-/),c=e[0],b=e[1]}catch(f){}return c=parseInt(c,10)||0,d=m(),a._$local&&(d+="-local"),a._rev=""+(c+1)+"-"+d,a._revisions={start:1,ids:[d]},b?(a._revisions.start+=c,a._revisions.ids.push(b)):void 0}function m(){return g(9)}function n(a){return a.rows.map(function(a){return a.doc})}function o(){var a;return a=w.getSinceNr(),w.isConnected()&&!A?"/_changes?include_docs=true&since="+a+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+a}function p(){B&&B.abort()}function q(a){return c(a.last_seq),u(a.results),w.isConnected()?w.pull():void 0}function r(b,c){if(w.isConnected())switch(b.status){case 401:return w.trigger("error:unauthenticated",c),w.disconnect();
case 404:return d.setTimeout(w.pull,3e3);case 500:return w.trigger("error:server",c),d.setTimeout(w.pull,3e3),a.checkConnection();default:return"abort"===b.statusText?w.pull():(d.setTimeout(w.pull,3e3),a.checkConnection())}}function s(){A=!1,w.trigger("bootstrap:end")}function t(a){A=!1,w.trigger("bootstrap:error",a)}function u(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e].doc,!(w.prefix&&0!==b._id.indexOf(w.prefix)||E[b._rev])){if(d=j(b),d._deleted){if(!w.isKnownObject(d))continue;c="remove",w.isKnownObject(d)}else w.isKnownObject(d)?c="update":(c="add",w.markAsKnownObject(d));w.trigger(c,d),w.trigger(d.type+":"+c,d),w.trigger(d.type+":"+d.id+":"+c,d),w.trigger("change",c,d),w.trigger(d.type+":change",c,d),w.trigger(d.type+":"+d.id+":change",c,d),w.trigger(c+":"+d.type,d),w.trigger(c+":"+d.type+":"+d.id,d),w.trigger("change:"+d.type,c,d),w.trigger("change:"+d.type+":"+d.id,c,d)}E={}}var v={};v.find=function(a,b){var c;return c=a+"/"+b,w.prefix&&(c=w.prefix+c),c="/"+encodeURIComponent(c),w.request("GET",c).then(j)},v.findAll=function(a){var b,c,d;switch(c="/_all_docs?include_docs=true",!0){case void 0!==a&&""!==w.prefix:d=w.prefix+a+"/";break;case void 0!==a:d=a+"/";break;case""!==w.prefix:d=w.prefix;break;default:d=""}return d&&(b=d.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),c=""+c+'&startkey="'+encodeURIComponent(d)+'"&endkey="'+encodeURIComponent(b)+'"'),w.request("GET",c).then(n).then(k)},v.save=function(a){var b;return a.id||(a.id=g()),a=i(a),b="/"+encodeURIComponent(a._id),w.request("PUT",b,{data:a})},v.remove=function(a,b){return w.update(a,b,{_deleted:!0})},v.removeAll=function(a){return w.updateAll(a,{_deleted:!0})};var w=e(a,{name:b.name,backend:{save:v.save,find:v.find,findAll:v.findAll,remove:v.remove,removeAll:v.removeAll}}),x=null;w.connected=!1,w.prefix="";var y=new RegExp("^");void 0!==b.name&&(x=b.name),void 0!==b.prefix&&(w.prefix=b.prefix,y=new RegExp("^"+w.prefix)),null!==b.baseUrl&&(w.baseUrl=b.baseUrl),w.request=function(b,c,d){return d=d||{},x&&(c="/"+encodeURIComponent(x)+c),w.baseUrl&&(c=""+w.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.request(b,c,d)},w.isKnownObject=function(a){var b=""+a.type+"/"+a.id;return void 0!==F[b]?F[b]:void 0},w.markAsKnownObject=function(a){var b=""+a.type+"/"+a.id;return F[b]=1,F[b]},w.connect=function(a){return a&&(x=a),w.connected=!0,w.trigger("connect"),w.bootstrap().then(function(){w.push()})},w.disconnect=function(){w.connected=!1,w.trigger("disconnect"),B&&B.abort(),D&&D.abort()},w.isConnected=function(){return w.connected};var z=b.since||0;w.getSinceNr=function(){return"function"==typeof z?z():z};var A=!1;w.bootstrap=function(){return A=!0,w.trigger("bootstrap:start"),w.pull().done(s).fail(t)};var B,C;w.pull=function(){return B=w.request("GET",o()),w.isConnected()&&(d.clearTimeout(C),C=d.setTimeout(p,25e3)),B.done(q).fail(r)};var D,E={};w.push=function(a){var b,c=[];if($.isArray(a)||(a=H()),0===a.length)return h([]);a=a.map(function(a){return f(!0,{},a)}),c=[];for(var d=0;d<a.length;d++)b=a[d],l(b),w.markAsKnownObject(b),b=i(b),c.push(b),E[b._rev]=1;return D=w.request("POST","/_bulk_docs",{data:{docs:c,new_edits:!1}}),D.done(function(){for(var b=0;b<a.length;b++)delete a[b]._revisions,w.trigger("push",a[b])}),D},w.sync=function(a){return w.push(a).then(w.pull)};var F={},G=["_id","_rev","_deleted","_revisions","_attachments"],H=function(){return[]};if(b.defaultObjectsToPush&&(H=$.isArray(b.defaultObjectsToPush)?function(){return b.defaultObjectsToPush}:b.defaultObjectsToPush),b.knownObjects)for(var I=0;I<b.knownObjects.length;I++)w.markAsKnownObject({type:b.knownObjects[I].type,id:b.knownObjects[I].id});return w}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("./api"),f=a("extend"),g=a("../../utils/generate_id"),h=a("../../utils/promise/resolve_with");b.exports=c},{"../../utils/generate_id":24,"../../utils/promise/resolve_with":34,"./api":17,extend:1}],20:[function(a,b){function c(a,b,c){var e=c.name||"store",f=c.type,g=c.id,h={};return g||(d(a,{context:h,namespace:e+":"+f}),h.save=function(a,c,d){return b.save(f,a,c,d)},h.add=function(a,c){return b.add(f,a,c)},h.find=function(a){return b.find(f,a)},h.findOrAdd=function(a,c){return b.findOrAdd(f,a,c)},h.findAll=function(a){return b.findAll(f,a)},h.update=function(a,c,d){return b.update(f,a,c,d)},h.updateAll=function(a,c){return b.updateAll(f,a,c)},h.remove=function(a,c){return b.remove(f,a,c)},h.removeAll=function(a){return b.removeAll(f,a)}),g&&(d(a,{context:h,namespace:e+":"+f+":"+g}),h.save=function(a,c){return b.save(f,g,a,c)},h.find=function(){return b.find(f,g)},h.update=function(a,c){return b.update(f,g,a,c)},h.remove=function(a){return b.remove(f,g,a)}),h.decoratePromises=b.decoratePromises,h.validate=b.validate,h}var d=a("../events");b.exports=c},{"../events":15}],21:[function(a,b){b.exports={scoped:a("./scoped")}},{"./scoped":22}],22:[function(a,b){function c(a,b,c){var e=c.type,f=c.id,g={};return f||(d(a,{context:g,namespace:"task:"+e}),g.start=function(a){return b.start(e,a)},g.abort=function(a){return b.abort(e,a)},g.restart=function(a,c){return b.restart(e,a,c)},g.abortAll=function(){return b.abortAll(e)},g.restartAll=function(a){return b.restartAll(e,a)}),f&&(d(a,{context:g,namespace:"task:"+e+":"+f}),g.abort=function(){return b.abort(e,f)},g.restart=function(a){return b.restart(e,f,a)}),g}var d=a("../events");b.exports=c},{"../events":15}],23:[function(a,b){function c(){d=e.getObject(h)||{}}var d,e=a("../utils/local_storage_wrapper"),f=a("extend"),g={},h="_hoodie_config";g.set=function(a,b){d[a]=b,e.setObject(h,d)},g.get=function(a){return a?d[a]:f({},d)},g.clear=function(){return d={},e.removeItem(h)},g.unset=function(a){delete d[a],e.setObject(h,d)},c(),b.exports=g},{"../utils/local_storage_wrapper":27,extend:1}],24:[function(a,b){function c(a){var b="";for(void 0===a&&(a=7),e=0;a>e;e++){var c=Math.random()*f,g=d[Math.floor(c)];b+=String(g).charAt(0)}return b}var d,e,f;d="0123456789abcdefghijklmnopqrstuvwxyz".split(""),f=d.length,b.exports=c},{}],25:[function(a,b){function c(a){return a=a.replace(d,function(a){return(a[1]||a[0]).toUpperCase()}),"Hoodie"+a+"Error"}var d=/(^\w|_\w)/g;b.exports=c},{}],26:[function(a,b){b.exports={config:a("./config"),generateId:a("./generate_id"),localStorageWrapper:a("./local_storage_wrapper"),promise:a("./promise")}},{"./config":23,"./generate_id":24,"./local_storage_wrapper":27,"./promise":29}],27:[function(a,b){function c(){f.isPersistent=d(),f.isPersistent||(f.getItem=function(){return null},f.setItem=function(){return null},f.removeItem=function(){return null},f.key=function(){return null},f.length=function(){return 0},f.isPersistent=function(){return!1})}function d(){try{if(!e.localStorage)return!1;if(localStorage.setItem("Storage-Test","1"),"1"!==localStorage.getItem("Storage-Test"))return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f={};f.setItem=function(a,b){e.localStorage.setItem(a,b)},f.getItem=function(a){return e.localStorage.getItem(a)},f.removeItem=function(a){return e.localStorage.removeItem(a)},f.clear=function(){return e.localStorage.clear()},f.key=function(a){return e.localStorage.key(a)},f.length=function(){return e.localStorage.length},f.setObject=function(a,b){return"object"!=typeof b?f.setItem(a,b):f.setItem(a,e.JSON.stringify(b))},f.getObject=function(a){var b=f.getItem(a);if(!b)return null;try{return e.JSON.parse(b)}catch(c){return b}},c(),b.exports=f},{}],28:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports=c.jQuery.Deferred},{}],29:[function(a,b){b.exports={defer:a("./defer"),isPromise:a("./is_promise"),rejectWith:a("./reject_with"),reject:a("./reject"),resolveWith:a("./resolve_with"),resolve:a("./resolve")}},{"./defer":28,"./is_promise":30,"./reject":31,"./reject_with":32,"./resolve":33,"./resolve_with":34}],30:[function(a,b){function c(a){return!(!a||"function"!=typeof a.done||"function"==typeof a.resolve)}b.exports=c},{}],31:[function(a,b){function c(){return d().reject().promise()}var d=a("./defer");b.exports=c},{"./defer":28}],32:[function(a,b){function c(a){var b=new e(a);return d().reject(b).promise()}var d=a("./defer"),e=a("../../lib/error/error");b.exports=c},{"../../lib/error/error":11,"./defer":28}],33:[function(a,b){function c(){return d().resolve().promise()}var d=a("./defer");b.exports=c},{"./defer":28}],34:[function(a,b){function c(){var a=d();return a.resolve.apply(a,arguments).promise()}var d=a("./defer");b.exports=c},{"./defer":28}]},{},[2])(2)});